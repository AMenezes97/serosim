<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="serosim">
<title>Case study 3: One pathogen system with cross-reactive strains (Influenza) • serosim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Case study 3: One pathogen system with cross-reactive strains (Influenza)">
<meta property="og:description" content="serosim">
<meta property="og:image" content="https://amenezes97.github.io/serosim/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">serosim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/case_study_1_measles.html">Case study 1: One pathogen system with vaccination (Measles)</a>
    <a class="dropdown-item" href="../articles/case_study_2_diphtheria_pertussis.html">Case study 2: Multi-pathogen system with multivalent vaccinaton (Diphtheria and Pertussis)</a>
    <a class="dropdown-item" href="../articles/case_study_3_influenza.html">Case study 3: One pathogen system with cross-reactive strains (Influenza)</a>
    <a class="dropdown-item" href="../articles/case_study_4_inference.html">Case study 4: Using serosim to assess the performance of seroepidemiological inference methods</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/AMenezes97/serosim/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Case study 3: One pathogen system with cross-reactive strains (Influenza)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AMenezes97/serosim/blob/HEAD/vignettes/case_study_3_influenza.Rmd" class="external-link"><code>vignettes/case_study_3_influenza.Rmd</code></a></small>
      <div class="d-none name"><code>case_study_3_influenza.Rmd</code></div>
    </div>

    
    
<p>Here, we will use the <em>serosim</em> package to generate a
cross-sectional serosurvey of a one pathogen system with cross-reactive
strains, modeled after influenza. This simulation will track natural
infection to multiple strains for 100 individuals across a 10 year
period. At the end of the 10 year period, we will conduct a
cross-sectional serological survey where we will use an discrete
haemagglutination assay to measure an individual’s biomarker level
against all strains.</p>
<p>We will set up each of the required arguments and models for
<em>runserosim</em> in the order outlined in the methods section of the
paper. In this example, biomarker quantity, titer level and antibody
level all mean the same thing.</p>
<p>We will use well characterized epidemiological and immunological
characteristics of influenza when selecting our models wherever possible
and make reasonable assumptions for other required models wherever
information is lacking. For this example, we will use arbitrarily
selected antibody kinetics parameters. Users can perform a literature
review to select the best parameters for their strains of interest.</p>
<p>Within each section below, we will briefly explain the rationale
behind our selected model inputs. We caution users to conduct their own
research into the models and associated parameters which best align with
their disease system and biomarker test kits.</p>
<p>Load necessary packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Install and load serosim </span></span>
<span><span class="co">## devtools::install_github("AMenezes97/serosim")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AMenezes97/serosim" class="external-link">serosim</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Load additional packages required </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="simulation-settings">1.1 Simulation Settings<a class="anchor" aria-label="anchor" href="#simulation-settings"></a>
</h2>
<p>We will simulate monthly time steps across a 10 year period.
Therefore, we will have 120 time steps. Note that these are arbitrary
time steps which will need to be scaled to the right time resolution to
match any time-based parameters used later on.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the number of time periods to simulate </span></span>
<span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">120</span>,by<span class="op">=</span><span class="fl">1</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## Set simulation settings</span></span>
<span><span class="va">simulation_settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"t_start"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"t_end"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="population-demography">1.2 Population Demography<a class="anchor" aria-label="anchor" href="#population-demography"></a>
</h2>
<p>For this case study, we are not interested in tracking any demography
information but we are interested in tracking individual’s birth time.
We will use the generate_pop_demography function to create the
demography tibble needed for <em>runserosim</em> . See case study 2 for
more information on how to add additional variables to the demography
tibble.</p>
<p>Note: The <em>runserosim</em> function, called later on, only
requires a demography tibble with two columns (individuals and
times).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the number of individuals in the simulation </span></span>
<span><span class="va">N</span><span class="op">&lt;-</span><span class="fl">100</span></span>
<span></span>
<span><span class="co">## Generate the population demography tibble</span></span>
<span><span class="co">## See help file(?generate_pop_demography) for more information on function arguments.</span></span>
<span><span class="co">## age_min is set to 0 which allows births to occur until the last time step</span></span>
<span><span class="co">## Let's assume that no individuals are removed from the population and set prob_removal to 0</span></span>
<span><span class="va">demography</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_pop_demography.html">generate_pop_demography</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">times</span>, age_min<span class="op">=</span><span class="fl">0</span>, prob_removal<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(i)`</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Examine the generated demography tibble</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">demography</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        i              birth           removal        times       </span></span>
<span><span class="co">##  Min.   :  1.00   Min.   :  2.00   Min.   :121   Min.   :  1.00  </span></span>
<span><span class="co">##  1st Qu.: 25.75   1st Qu.: 33.75   1st Qu.:121   1st Qu.: 30.75  </span></span>
<span><span class="co">##  Median : 50.50   Median : 58.50   Median :121   Median : 60.50  </span></span>
<span><span class="co">##  Mean   : 50.50   Mean   : 61.15   Mean   :121   Mean   : 60.50  </span></span>
<span><span class="co">##  3rd Qu.: 75.25   3rd Qu.: 86.00   3rd Qu.:121   3rd Qu.: 90.25  </span></span>
<span><span class="co">##  Max.   :100.00   Max.   :119.00   Max.   :121   Max.   :120.00</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="exposure-to-biomarker-mapping">1.3 Exposure to biomarker mapping<a class="anchor" aria-label="anchor" href="#exposure-to-biomarker-mapping"></a>
</h2>
<p>Now we set up the exposure IDs and biomarker IDs for the simulation
which will determine which infections are occurring and which biomarkers
are being boosted and tracked. Here, we will simulate three circulating
strains of influenza strain_a, strain_b and strain_c. Each strain will
boost biomarkers to all three strains. These boost parameters will be
specified in section 1.6.</p>
<p><em>runserosim</em> requires that exposure_id and biomarker_id are
numeric so we will use the reformat_biomarker_map function to create a
new version of the biomarker map. Users can go directly to numeric
biomarker_map if they wish.</p>
<p>Note that the reformat_biomarker_map function will number the
exposures and biomarkers in alphabetical order so that the first
exposure event or biomarker that is listed will not necessarily be
labeled as 1.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create biomarker map</span></span>
<span><span class="va">biomarker_map_original</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>exposure_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"strain_a"</span>,<span class="st">"strain_a"</span>,<span class="st">"strain_a"</span>,<span class="st">"strain_b"</span>,<span class="st">"strain_b"</span>,<span class="st">"strain_b"</span>, <span class="st">"strain_c"</span>,<span class="st">"strain_c"</span>,<span class="st">"strain_c"</span><span class="op">)</span>,biomarker_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"biomarker_a"</span>,<span class="st">"biomarker_b"</span>,<span class="st">"biomarker_c"</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">biomarker_map_original</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 2</span></span></span>
<span><span class="co">##   exposure_id biomarker_id</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> strain_a    biomarker_a </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> strain_a    biomarker_b </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> strain_a    biomarker_c </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> strain_b    biomarker_a </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> strain_b    biomarker_b </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> strain_b    biomarker_c </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> strain_c    biomarker_a </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> strain_c    biomarker_b </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span> strain_c    biomarker_c</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Reformat biomarker_map for runserosim</span></span>
<span><span class="va">biomarker_map</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/reformat_biomarker_map.html">reformat_biomarker_map</a></span><span class="op">(</span><span class="va">biomarker_map_original</span><span class="op">)</span></span>
<span><span class="va">biomarker_map</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 2</span></span></span>
<span><span class="co">##   exposure_id biomarker_id</span></span>
<span><span class="co">##         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>           1            1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>           1            2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>           1            3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>           2            1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>           2            2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>           2            3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span>           3            1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span>           3            2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span>           3            3</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="force-of-exposure-and-exposure-model">1.4 Force of Exposure and Exposure Model<a class="anchor" aria-label="anchor" href="#force-of-exposure-and-exposure-model"></a>
</h2>
<p>Now, we need to specify the foe_pars argument which contains the
force of exposure for all exposure_IDs across all time steps. We also
specify the exposure model which will be called within
<em>runserosim</em> later. The exposure model will determine the
probability that an individual is exposed to a specific exposure
event.</p>
<p>Since we did not specify different groups within demography, all
individuals will automatically be assigned group 1. Therefore, we only
need 1 row for dimension 1 in foe_pars. Groups can be used as an
indicator of location if the user wishes to specify a location specific
force of exposure (See case study 2). Dimension 3 of the foe_array must
be in the same order as the exposure_id within the biomarker map. For
example, the force of exposure for exposure_id 1 will be inputted within
the foe_pars[,,1].</p>
<p>Here, we specified the same force of exposure for circulating strains
within foe_pars for simplicity but users will likely have varying
numbers to match real world settings. Each strain is only circulating
for 40 time steps with no co-circulation.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create an empty array to store the force of exposure for all exposure types</span></span>
<span><span class="va">foe_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>,<span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">biomarker_map</span><span class="op">$</span><span class="va">exposure_id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Specify the force of exposure for exposure ID 1 which represents strain A circulation</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">40</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span>,<span class="fl">41</span><span class="op">:</span><span class="fl">80</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span>,<span class="fl">81</span><span class="op">:</span><span class="fl">120</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="co">## Specify the force of exposure for exposure ID 2 which represents strain B circulation</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">40</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span>,<span class="fl">41</span><span class="op">:</span><span class="fl">80</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span>,<span class="fl">81</span><span class="op">:</span><span class="fl">120</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="co">## Specify the force of exposure for exposure ID 3 which represents strain C circulation</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">40</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span>,<span class="fl">41</span><span class="op">:</span><span class="fl">80</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span>,<span class="fl">81</span><span class="op">:</span><span class="fl">120</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span></span>
<span><span class="co">## Specify a simple exposure model which calculates the probability of exposure directly from the force of exposure at that time step. In this selected model, the probability of exposure is 1-exp(-FOE) where FOE is the force of exposure at that time.</span></span>
<span><span class="va">exposure_model</span><span class="op">&lt;-</span><span class="va">exposure_model_simple_FOE</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Examine the probability of exposure to each strain over time for the specified exposure model and foe_pars array</span></span>
<span><span class="fu"><a href="../reference/plot_exposure_model.html">plot_exposure_model</a></span><span class="op">(</span>exposure_model<span class="op">=</span><span class="va">exposure_model_simple_FOE</span>, times<span class="op">=</span><span class="va">times</span>, n_groups <span class="op">=</span> <span class="fl">1</span>, n_exposures <span class="op">=</span> <span class="fl">3</span>, foe_pars<span class="op">=</span><span class="va">foe_pars</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_3_influenza_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="immunity-model">1.5 Immunity Model<a class="anchor" aria-label="anchor" href="#immunity-model"></a>
</h2>
<p>Here, we specify the immunity model which will determine the
probability that an exposure event is successful in inducing an
immunological response. Since we have multiple cross-reactive influenza
strains we will use immunity_model_ifxn_biomarker_prot. With this
immunity model, the probability of a successful infection depends on the
biomarker quantity to all three strains, in this case influenza antibody
titer, at the time of exposure.</p>
<p>Additional successful exposure events aka “reinfection” events are
representative of boosting events. The user can limit the frequency of
reinfections by adjusting the biomarker-mediated protection (also known
as titer-mediated protection) parameters or by specifying a maximum
number of allowed successful exposure events. The titer-mediated
protection parameters used within this model are defined within
model_pars which will be loaded in section 1.6.</p>
<p>Here, we placed no limit on the maximum number of infections to
either of the three influenza strains however our selected immunity
model will take into account an individual’s current biomarker level
when determining the probability of a successful infection.</p>
<p>Our chosen immunity model has an optional argument
(cross_reactivity_table) which allows users to specify specify whether
other biomarker quantities are also protective against successful
exposure. For this example, biomarkers against the infecting strain
(e.g., exposure_id=strain_a and biomarker_id=biomarker_a) have 100%
cross-reactivity while other biomarkers have varying levels of
cross-reactivity.</p>
<p>Again, the following cross-reactivity and biomarker-mediated
protection parameters were selected arbitrarily.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify immunity model within the runserosim function below </span></span>
<span><span class="va">immunity_model</span><span class="op">&lt;-</span><span class="va">immunity_model_ifxn_biomarker_prot</span></span>
<span><span class="co">## The immunity model we selected will take into account an individual's current biomarker quantity to all three strains and the cross-reactivity between different biomarkers when determining the probability of successful infection. </span></span>
<span></span>
<span><span class="co">## Specify the maximum number of successful exposure events an individual can receive for each exposure type</span></span>
<span><span class="co">## We placed no successful exposure limit on the number influenza infection exposures</span></span>
<span><span class="va">max_events</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">Inf</span>,<span class="cn">Inf</span>,<span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Specify the cross-reactivity table argument which will be used by the immunity model. </span></span>
<span><span class="va">cr_table</span> <span class="op">&lt;-</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  exposure_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"strain_a"</span>,<span class="st">"strain_a"</span>,<span class="st">"strain_a"</span>,<span class="st">"strain_b"</span>,<span class="st">"strain_b"</span>,<span class="st">"strain_b"</span>, <span class="st">"strain_c"</span>,<span class="st">"strain_c"</span>,<span class="st">"strain_c"</span><span class="op">)</span>,</span>
<span>  biomarker_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"biomarker_a"</span>,<span class="st">"biomarker_b"</span>,<span class="st">"biomarker_c"</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>  cross_reactivity<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">0.5</span>,<span class="fl">0.25</span>,<span class="fl">.5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## The cross_reactivity table also requires that exposure_id and biomarker_id are numeric. The reformat_biomarker_map function will convert both columns to numbers. </span></span>
<span><span class="va">cr_table</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/reformat_biomarker_map.html">reformat_biomarker_map</a></span><span class="op">(</span><span class="va">cr_table</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot biomarker-mediated protection curve given parameters specified within model_pars for biomarker 1, influenza strain A antibody  (DP_antibody) which will be loaded in section 1.6. Biomarker mediated protection parameters are the same for all 3 influenza strains so the following plot will look the same for all exposure/biomarker types.</span></span>
<span><span class="fu"><a href="../reference/plot_biomarker_mediated_protection.html">plot_biomarker_mediated_protection</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">120</span>, biomarker_prot_midpoint<span class="op">=</span><span class="fl">40</span>, biomarker_prot_width<span class="op">=</span><span class="fl">.09</span><span class="op">)</span> </span></code></pre></div>
<p><img src="case_study_3_influenza_files/figure-html/unnamed-chunk-9-1.png" width="288"></p>
</div>
<div class="section level2">
<h2 id="antibody-model-and-model-parameters">1.6 Antibody Model and Model Parameters<a class="anchor" aria-label="anchor" href="#antibody-model-and-model-parameters"></a>
</h2>
<p>Now, we specify the antibody model to be used within
<em>runserosim</em> to track antibody kinetics, or more broadly
biomarker kinetics for each biomarker produced from successful exposure
events. We will be using a monophasic boosting-waning model in this
example. This model assumes that for each exposure there is a boost and
boost waning parameter.</p>
<p>The antibody kinetics parameters are pre-loaded within a csv file.
Users can edit the csv file to specify their own parameters. All
parameters needed for the user specified antibody model must be
specified within the model_pars.</p>
<p>Lastly, we define the draw_parameters function which determines how
each individual’s antibody kinetics parameters are simulated from the
within-host processes parameters tibble (model_pars). We will use a
function which draws parameters directly from model_pars for the
antibody model with random effects to represent individual heterogeneity
in immunological responses. Parameters are drawn randomly from a
distribution with mean and standard deviation specified within
model_pars.</p>
<p><em>runserosim</em> requires that exposure_id and biomarker_id within
model_pars are numeric and match the exposure to biomarker map so we
will use the reformat_biomarker_map function again to create a new
version of model_pars. Users can go directly to numeric model_pars if
they wish.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the antibody model </span></span>
<span><span class="va">antibody_model</span><span class="op">&lt;-</span><span class="va">antibody_model_monophasic</span></span>
<span></span>
<span><span class="co">## Bring in the antibody parameters needed for the antibody model</span></span>
<span><span class="co">## Note that the observation error parameter needed for the observation model (Section 1.7) is defined here too.</span></span>
<span><span class="va">model_pars_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"model_pars_cs3.csv"</span>, package <span class="op">=</span> <span class="st">"serosim"</span><span class="op">)</span></span>
<span><span class="va">model_pars_original</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">model_pars_path</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">model_pars_original</span></span></code></pre></div>
<pre><code><span><span class="co">##    exposure_id biomarker_id                    name  mean    sd distribution</span></span>
<span><span class="co">## 1     strain_a  biomarker_a                   boost 80.00 3e+01   log-normal</span></span>
<span><span class="co">## 2     strain_a  biomarker_a                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 3     strain_a  biomarker_b                   boost 40.00 1e+01   log-normal</span></span>
<span><span class="co">## 4     strain_a  biomarker_b                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 5     strain_a  biomarker_c                   boost 20.00 1e+01   log-normal</span></span>
<span><span class="co">## 6     strain_a  biomarker_c                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 7     strain_a  biomarker_a biomarker_prot_midpoint 40.00    NA             </span></span>
<span><span class="co">## 8     strain_a  biomarker_a    biomarker_prot_width  0.09    NA             </span></span>
<span><span class="co">## 9         &lt;NA&gt;  biomarker_a                  obs_sd    NA 1e+01       normal</span></span>
<span><span class="co">## 10    strain_b  biomarker_a                   boost 40.00 1e+01   log-normal</span></span>
<span><span class="co">## 11    strain_b  biomarker_a                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 12    strain_b  biomarker_b                   boost 80.00 3e+01   log-normal</span></span>
<span><span class="co">## 13    strain_b  biomarker_b                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 14    strain_b  biomarker_c                   boost 40.00 1e+01   log-normal</span></span>
<span><span class="co">## 15    strain_b  biomarker_c                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 16    strain_b  biomarker_b biomarker_prot_midpoint 40.00    NA             </span></span>
<span><span class="co">## 17    strain_b  biomarker_b    biomarker_prot_width  0.09    NA             </span></span>
<span><span class="co">## 18        &lt;NA&gt;  biomarker_b                  obs_sd    NA 1e+01       normal</span></span>
<span><span class="co">## 19    strain_c  biomarker_a                   boost 20.00 1e+01   log-normal</span></span>
<span><span class="co">## 20    strain_c  biomarker_a                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 21    strain_c  biomarker_b                   boost 40.00 1e+01   log-normal</span></span>
<span><span class="co">## 22    strain_c  biomarker_b                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 23    strain_c  biomarker_c                   boost 80.00 3e+01   log-normal</span></span>
<span><span class="co">## 24    strain_c  biomarker_c                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 25    strain_c  biomarker_c biomarker_prot_midpoint 40.00    NA             </span></span>
<span><span class="co">## 26    strain_c  biomarker_c    biomarker_prot_width  0.09    NA             </span></span>
<span><span class="co">## 27        &lt;NA&gt;  biomarker_c                  obs_sd    NA 1e+01       normal</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># model_pars_original &lt;- read.csv("~/Documents/GitHub/serosim/inst/extdata/model_pars_cs3.csv")</span></span>
<span><span class="co"># model_pars_original</span></span>
<span></span>
<span><span class="co">## Reformat model_pars for runserosim</span></span>
<span><span class="va">model_pars</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/reformat_biomarker_map.html">reformat_biomarker_map</a></span><span class="op">(</span><span class="va">model_pars_original</span><span class="op">)</span></span>
<span><span class="va">model_pars</span></span></code></pre></div>
<pre><code><span><span class="co">##    exposure_id biomarker_id                    name  mean    sd distribution</span></span>
<span><span class="co">## 1            1            1                   boost 80.00 3e+01   log-normal</span></span>
<span><span class="co">## 2            1            1                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 3            1            2                   boost 40.00 1e+01   log-normal</span></span>
<span><span class="co">## 4            1            2                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 5            1            3                   boost 20.00 1e+01   log-normal</span></span>
<span><span class="co">## 6            1            3                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 7            1            1 biomarker_prot_midpoint 40.00    NA             </span></span>
<span><span class="co">## 8            1            1    biomarker_prot_width  0.09    NA             </span></span>
<span><span class="co">## 9           NA            1                  obs_sd    NA 1e+01       normal</span></span>
<span><span class="co">## 10           2            1                   boost 40.00 1e+01   log-normal</span></span>
<span><span class="co">## 11           2            1                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 12           2            2                   boost 80.00 3e+01   log-normal</span></span>
<span><span class="co">## 13           2            2                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 14           2            3                   boost 40.00 1e+01   log-normal</span></span>
<span><span class="co">## 15           2            3                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 16           2            2 biomarker_prot_midpoint 40.00    NA             </span></span>
<span><span class="co">## 17           2            2    biomarker_prot_width  0.09    NA             </span></span>
<span><span class="co">## 18          NA            2                  obs_sd    NA 1e+01       normal</span></span>
<span><span class="co">## 19           3            1                   boost 20.00 1e+01   log-normal</span></span>
<span><span class="co">## 20           3            1                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 21           3            2                   boost 40.00 1e+01   log-normal</span></span>
<span><span class="co">## 22           3            2                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 23           3            3                   boost 80.00 3e+01   log-normal</span></span>
<span><span class="co">## 24           3            3                    wane  0.02 5e-03   log-normal</span></span>
<span><span class="co">## 25           3            3 biomarker_prot_midpoint 40.00    NA             </span></span>
<span><span class="co">## 26           3            3    biomarker_prot_width  0.09    NA             </span></span>
<span><span class="co">## 27          NA            3                  obs_sd    NA 1e+01       normal</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the draw_parameters function</span></span>
<span><span class="va">draw_parameters</span><span class="op">&lt;-</span><span class="va">draw_parameters_random_fx</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot example biomarker trajectories given the specified antibody kinetics model, model parameters and draw parameters function </span></span>
<span><span class="fu"><a href="../reference/plot_antibody_model.html">plot_antibody_model</a></span><span class="op">(</span><span class="va">antibody_model_monophasic</span>, N<span class="op">=</span><span class="fl">100</span>, model_pars<span class="op">=</span><span class="va">model_pars</span>,draw_parameters_fn <span class="op">=</span> <span class="va">draw_parameters_random_fx</span>, biomarker_map<span class="op">=</span><span class="va">biomarker_map</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_3_influenza_files/figure-html/unnamed-chunk-11-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="observation-model-and-observation_times">1.7 Observation Model and observation_times<a class="anchor" aria-label="anchor" href="#observation-model-and-observation_times"></a>
</h2>
<p>Now we specify how observed influenza biomarker quantities are
generated as a probabilistic function of the true, latent biomarker
quantity and when to observe these quantities. In this step, we specify
the sampling design and assay choice for our serological survey. We will
take samples of all individuals at the end of the simulation
(t=120).</p>
<p>Our chosen observation model observes the latent influenza biomarker
quantity for all three biomarkers given a discrete assay with added
noise. The added noise represents assay variability and is implemented
by sampling from a distribution with the true latent biomarker quantity
as the mean and the measurement error as the standard deviation. The
observation standard deviation and distribution are defined within
model_pars as the “obs_sd” parameter. Within this observation model, we
can also specify the assay sensitivity and specificity.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the observation model </span></span>
<span><span class="va">observation_model</span><span class="op">&lt;-</span><span class="va">observation_model_discrete</span></span>
<span></span>
<span><span class="co">## Specify the cutoffs for the discrete assay. This will depend on the dilutions of the haemagglutination assay.</span></span>
<span><span class="co">## This is a matrix with each row containing all of the cutoffs for that biomarker. Here, we have set the same cutoffs for all three biomarkers </span></span>
<span><span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">120</span>,by<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">cutoffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">breaks</span>,nrow<span class="op">=</span><span class="fl">3</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Specify assay sensitivity and specificity needed for the observation model</span></span>
<span><span class="va">sensitivity</span><span class="op">&lt;-</span><span class="fl">0.85</span></span>
<span><span class="va">specificity</span><span class="op">&lt;-</span><span class="fl">0.9</span></span>
<span></span>
<span><span class="co">## Specify observation_times (serological survey sampling design) to observe all three biomarkers across all individuals at the end of the simulation (t=120)</span></span>
<span><span class="va">obs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>i<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>,t<span class="op">=</span><span class="fl">120</span>, b<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">obs2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>i<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>,t<span class="op">=</span><span class="fl">120</span>, b<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">obs3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>i<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>,t<span class="op">=</span><span class="fl">120</span>, b<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">observation_times</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">obs1</span>,<span class="va">obs2</span>,<span class="va">obs3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="optional-arguments">1.8 Optional Arguments<a class="anchor" aria-label="anchor" href="#optional-arguments"></a>
</h2>
<p>There are no optional arguments needed for this simulation.</p>
</div>
<div class="section level2">
<h2 id="run-simulation">1.9 Run Simulation<a class="anchor" aria-label="anchor" href="#run-simulation"></a>
</h2>
<p>This is the core simulation where all simulation settings, models and
parameters are specified within the main simulation function. Run time
for this step varies depending on the number of individuals and the
complexities of the specified models. There is a built in
pre-computation step within <em>runserosim</em> where the simulation
attempts to perform as much pre-computation as possible for the exposure
model to speed up the main simulation code. Users can turn off this
pre-computation by setting pre-computation to FALSE within
<em>runserosim</em>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Run the core simulation and save outputs in "res"</span></span>
<span><span class="va">res</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/runserosim.html">runserosim</a></span><span class="op">(</span></span>
<span>  <span class="va">simulation_settings</span>,</span>
<span>  <span class="va">demography</span>,</span>
<span>  <span class="va">observation_times</span>,</span>
<span>  <span class="va">foe_pars</span>,</span>
<span>  <span class="va">biomarker_map</span>,</span>
<span>  <span class="va">model_pars</span>,</span>
<span>  <span class="va">exposure_model</span>,</span>
<span>  <span class="va">immunity_model</span>,</span>
<span>  <span class="va">antibody_model</span>,</span>
<span>  <span class="va">observation_model</span>,</span>
<span>  <span class="va">draw_parameters</span>,</span>
<span></span>
<span>  <span class="co">## Other arguments needed</span></span>
<span>  max_events<span class="op">=</span><span class="va">max_events</span>,</span>
<span>  cutoffs<span class="op">=</span><span class="va">cutoffs</span>,</span>
<span>  cross_reactivity_table<span class="op">=</span><span class="va">cr_table</span>,</span>
<span>  sensitivity<span class="op">=</span><span class="va">sensitivity</span>,</span>
<span>  specificity<span class="op">=</span><span class="va">specificity</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Note that models and arguments specified earlier in the code can be specified directly within this function.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generate-plots">1.10 Generate Plots<a class="anchor" aria-label="anchor" href="#generate-plots"></a>
</h2>
<p>Now that the simulation is complete, let’s plot and examine the
simulation outputs.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot influenza strain A specific biomarker kinetics and exposure histories for 10 individuals </span></span>
<span><span class="fu"><a href="../reference/plot_subset_individuals_history.html">plot_subset_individuals_history</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">biomarker_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">b</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>, <span class="va">res</span><span class="op">$</span><span class="va">exposure_histories_long</span>, subset<span class="op">=</span><span class="fl">10</span>, <span class="va">demography</span>, removal<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 109 rows containing missing values (`geom_line()`).</span></span></code></pre>
<p><img src="case_study_3_influenza_files/figure-html/unnamed-chunk-14-1.png" width="576"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot influenza strain B specific biomarker kinetics and exposure histories for 10 individuals </span></span>
<span><span class="fu"><a href="../reference/plot_subset_individuals_history.html">plot_subset_individuals_history</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">biomarker_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">b</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span>, <span class="va">res</span><span class="op">$</span><span class="va">exposure_histories_long</span>, subset<span class="op">=</span><span class="fl">10</span>, <span class="va">demography</span>, removal<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 82 rows containing missing values (`geom_line()`).</span></span></code></pre>
<p><img src="case_study_3_influenza_files/figure-html/unnamed-chunk-15-1.png" width="576"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot influenza strain C specific biomarker kinetics and exposure histories for 10 individuals </span></span>
<span><span class="fu"><a href="../reference/plot_subset_individuals_history.html">plot_subset_individuals_history</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">biomarker_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">b</span><span class="op">==</span><span class="fl">3</span><span class="op">)</span>, <span class="va">res</span><span class="op">$</span><span class="va">exposure_histories_long</span>, subset<span class="op">=</span><span class="fl">10</span>, <span class="va">demography</span>, removal<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 66 rows containing missing values (`geom_line()`).</span></span></code></pre>
<p><img src="case_study_3_influenza_files/figure-html/unnamed-chunk-16-1.png" width="576"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot individual probability of exposure for all exposure types.</span></span>
<span><span class="co">## This is the output of the exposure model. Note that this reflects our inputs that the influenza strains were never co-circulating.</span></span>
<span><span class="fu"><a href="../reference/plot_exposure_force.html">plot_exposure_force</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">exposure_force_long</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_3_influenza_files/figure-html/unnamed-chunk-17-1.png" width="480"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot individual successful exposure probabilities for all exposure types</span></span>
<span><span class="co">## This is the output of the exposure model multiplied by the output of the immunity model.</span></span>
<span><span class="co">## In other words, this is the probability of exposure event being successful and inducing an immunological response</span></span>
<span><span class="fu"><a href="../reference/plot_exposure_prob.html">plot_exposure_prob</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">exposure_probabilities_long</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_3_influenza_files/figure-html/unnamed-chunk-18-1.png" width="480"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot individual exposure histories for all exposure types</span></span>
<span><span class="fu"><a href="../reference/plot_exposure_histories.html">plot_exposure_histories</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">exposure_histories_long</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_3_influenza_files/figure-html/unnamed-chunk-19-1.png" width="480"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot influenza strain A antibody (biomarker 1) states for all individuals (true biomarker quantities)</span></span>
<span><span class="fu"><a href="../reference/plot_biomarker_quantity.html">plot_biomarker_quantity</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">biomarker_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">b</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_3_influenza_files/figure-html/unnamed-chunk-20-1.png" width="384"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot influenza strain B antibody (biomarker 2) states for all individuals (true biomarker quantities)</span></span>
<span><span class="fu"><a href="../reference/plot_biomarker_quantity.html">plot_biomarker_quantity</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">biomarker_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">b</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_3_influenza_files/figure-html/unnamed-chunk-21-1.png" width="384"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot influenza strain C antibody (biomarker 3) states for all individuals (true biomarker quantities)</span></span>
<span><span class="fu"><a href="../reference/plot_biomarker_quantity.html">plot_biomarker_quantity</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">biomarker_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">b</span><span class="op">==</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_3_influenza_files/figure-html/unnamed-chunk-22-1.png" width="384"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot the influenza strain A serosurvey results (observed biomarker quantities)</span></span>
<span><span class="fu"><a href="../reference/plot_obs_biomarkers_one_sample.html">plot_obs_biomarkers_one_sample</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">observed_biomarker_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">b</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_3_influenza_files/figure-html/unnamed-chunk-23-1.png" width="384"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot the influenza strain B serosurvey results (observed biomarker quantities)</span></span>
<span><span class="fu"><a href="../reference/plot_obs_biomarkers_one_sample.html">plot_obs_biomarkers_one_sample</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">observed_biomarker_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">b</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_3_influenza_files/figure-html/unnamed-chunk-24-1.png" width="384"></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot the influenza strain C serosurvey results (observed biomarker quantities)</span></span>
<span><span class="fu"><a href="../reference/plot_obs_biomarkers_one_sample.html">plot_obs_biomarkers_one_sample</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">observed_biomarker_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">b</span><span class="op">==</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_3_influenza_files/figure-html/unnamed-chunk-25-1.png" width="384"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Note that the simulated kinetics parameters are also stored</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">kinetics_parameters</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">##       i     t     x     b name    value realized_value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1    76     2     1 boost 58.1           58.1   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     1    76     2     1 wane   0.023<span style="text-decoration: underline;">9</span>         0.023<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     1    76     2     2 boost 91.7           91.7   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     1    76     2     2 wane   0.022<span style="text-decoration: underline;">2</span>         0.022<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>     1    76     2     3 boost 43.8           43.8   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>     1    76     2     3 wane   0.020<span style="text-decoration: underline;">5</span>         0.020<span style="text-decoration: underline;">5</span></span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Arthur Menezes, James Hay.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
