<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="serosim">
<title>Paper case study 2: Multi-pathogen system with multivalent vaccinaton (Diphtheria and Pertussis) • serosim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Paper case study 2: Multi-pathogen system with multivalent vaccinaton (Diphtheria and Pertussis)">
<meta property="og:description" content="serosim">
<meta property="og:image" content="https://amenezes97.github.io/serosim/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">serosim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/case_study_1_measles.html">Paper case study 1: One pathogen system with vaccination (Measles)</a>
    <a class="dropdown-item" href="../articles/case_study_2_diphtheria_pertussis.html">Paper case study 2: Multi-pathogen system with multivalent vaccinaton (Diphtheria and Pertussis)</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/AMenezes97/serosim/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Paper case study 2: Multi-pathogen system with multivalent vaccinaton (Diphtheria and Pertussis)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AMenezes97/serosim/blob/HEAD/vignettes/case_study_2_diphtheria_pertussis.Rmd" class="external-link"><code>vignettes/case_study_2_diphtheria_pertussis.Rmd</code></a></small>
      <div class="d-none name"><code>case_study_2_diphtheria_pertussis.Rmd</code></div>
    </div>

    
    
<p>Here, we will use the <em>serosim</em> package to generate a
cross-sectional serosurvey of a multi-pathogen system with multivalent
vaccination. The overall structure and principles discussed within this
case study are applicable to pathogen systems like measles, mumps, and
rubella with MMR vaccination or diphtheria, tetanus, and pertussis
system with DTP vaccination among many others. This simulation will
track natural infection to pathogen A, natural infection to pathogen B
and bivalent vaccination with pathogen A and pathogen B specific
biomarkers for 100 individuals across a 10 year period. At the end of
the 10 year period, we will measure biomarker quantities against both
pathogen A specific biomarkers and pathogen B specific biomarkers for
all individuals. We will set up each of the required arguments and
models for <em>runserosim</em> in the order outlined in the methods
section of the paper.</p>
<p>This case study is built around diphtheria and pertussis and we are
interested in tracking bivalent vaccination and both diphtheria and
pertussis natural infection across a 10 year period. We will conduct a
cross-sectional serological survey where we will use an ELISA kit to
measure an individual’s diphtheria and pertussis IgG titer.In this
example, biomarker quantity, titer level and antibody level all mean the
same thing.</p>
<p>We will use published diphtheria and pertussis serological surveys
and any well characterized epidemiological and immunological
characteristics of diphtheria and pertussis to parameterize our models
wherever possible and make reasonable assumptions for other required
model parameters wherever information is lacking.</p>
<p>We narrowed our search to diphtheria and pertussis serological
surveys conducted with ELISA IgG test kits that reported quantitative
titers in comparable units. We did not conduct an extensive search of
all diphtheria and pertussis serological surveys in order to
parameterize our models as it is beyond the scope of this case study.
Our aim was to provide a simple example of how users can use the
literature to inform required <em>serosim</em> inputs. Within each
section below, we will briefly explain the rationale behind our selected
model inputs. We caution users to conduct their own research into the
models and associated parameters which best align with their disease
system and biomarker test kits.</p>
<p>Load necessary packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Install and load serosim </span></span>
<span><span class="co">## devtools::install_github("AMenezes97/serosim")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AMenezes97/serosim" class="external-link">serosim</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Load additional packages required </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="simulation-settings">1.1 Simulation Settings<a class="anchor" aria-label="anchor" href="#simulation-settings"></a>
</h2>
<p>We will simulate monthly time steps across a 10 year period.
Therefore, we will have 120 time steps. Note that these are arbitrary
time steps which will need to be scaled to the right time resolution to
match any time-based parameters used later on.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the number of time periods to simulate </span></span>
<span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">120</span>,by<span class="op">=</span><span class="fl">1</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## Set simulation settings</span></span>
<span><span class="va">simulation_settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"t_start"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"t_end"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="population-demography">1.2 Population Demography<a class="anchor" aria-label="anchor" href="#population-demography"></a>
</h2>
<p>For this case study, we are interested in tracking an individual’s
socioeconomic status, group(a proxy for location), birth and removal
time. We will use the generate_pop_demography function to create the
demography tibble needed for <em>runserosim</em>.</p>
<p>Note: The <em>runserosim</em> function, called later on, only
requires a demography tibble with two columns (individuals and
times).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the number of individuals in the simulation </span></span>
<span><span class="va">N</span><span class="op">&lt;-</span><span class="fl">100</span></span>
<span></span>
<span><span class="co">## Pre-load the demography categories, values and distributions </span></span>
<span><span class="co">## Specify options for each demography element and the distribution of each within the population</span></span>
<span><span class="co">## We are interested in simulating a population where individuals have varying nutritional status and can reside in either of 2 locations</span></span>
<span><span class="va">aux</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"NS"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">=</span><span class="st">"NS"</span>,<span class="st">"options"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>,<span class="st">"medium"</span>,<span class="st">"high"</span><span class="op">)</span>, <span class="st">"distribution"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="fl">0.3</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="st">"Group"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">=</span><span class="st">"group"</span>,<span class="st">"options"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"distribution"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## Generate the population demography tibble</span></span>
<span><span class="co">## Let's assume that individuals are removed from the population and set prob_removal to 0.2</span></span>
<span><span class="va">demography</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_pop_demography.html">generate_pop_demography</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">times</span>, age_min<span class="op">=</span><span class="fl">0</span>, removal_min<span class="op">=</span><span class="fl">1</span>, removal_max<span class="op">=</span><span class="fl">120</span>, prob_removal<span class="op">=</span><span class="fl">0.2</span>, aux<span class="op">=</span><span class="va">aux</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(i)`</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Examine the generated demography tibble</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">demography</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">##       i birth removal times NS    group</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1    54     110     1 high      1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     1    54     110     2 high      1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     1    54     110     3 high      1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     1    54     110     4 high      1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>     1    54     110     5 high      1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>     1    54     110     6 high      1</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">demography</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">##       i birth removal times NS     group</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>   100   108     111   115 medium     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>   100   108     111   116 medium     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>   100   108     111   117 medium     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>   100   108     111   118 medium     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>   100   108     111   119 medium     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>   100   108     111   120 medium     1</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="exposure-to-biomarker-mapping">1.3 Exposure to biomarker mapping<a class="anchor" aria-label="anchor" href="#exposure-to-biomarker-mapping"></a>
</h2>
<p>Now, we have to set up the exposure IDs and biomarker IDs for our
desired simulation. Individuals can be seropositive either by natural
infection or by vaccination and we want to track both exposure types
separately.</p>
<p>In this case, we need three exposure IDs:</p>
<ol style="list-style-type: decimal">
<li>Diphtheria natural infection (DP_ifxn)</li>
<li>Pertussis natural infection (PT_ifxn)</li>
<li>Diphtheria and pertussis combined vaccination (vacc)</li>
</ol>
<p>And two biomarker IDs:</p>
<ol style="list-style-type: decimal">
<li>Diphtheria specific biomarkers (DP_antibody)</li>
<li>Pertussis specific biomarkers (PT_antibody)</li>
</ol>
<p><em>runserosim</em> requires that exposure_id and biomarker_id are
numeric so we will use the reformat_biomarker_map function to create a
new version of the biomarker map. Users can go directly to numeric
biomarker_map if they wish. Note that the reformat_biomarker_map
function will number the exposures and biomarkers in alphabetical order
so that the first exposure event or biomarker that is listed will not
necessarily be labeled as 1.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create biomarker map</span></span>
<span><span class="va">biomarker_map_original</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>exposure_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DP_ifxn"</span>,<span class="st">"PT_ifxn"</span>,<span class="st">"vacc"</span>,<span class="st">"vacc"</span><span class="op">)</span>,biomarker_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DP_antibody"</span>,<span class="st">"PT_antibody"</span>,<span class="st">"DP_antibody"</span>,<span class="st">"PT_antibody"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">biomarker_map_original</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">##   exposure_id biomarker_id</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> DP_ifxn     DP_antibody </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> PT_ifxn     PT_antibody </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> vacc        DP_antibody </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> vacc        PT_antibody</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Reformat biomarker_map for runserosim</span></span>
<span><span class="va">biomarker_map</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/reformat_biomarker_map.html">reformat_biomarker_map</a></span><span class="op">(</span><span class="va">biomarker_map_original</span><span class="op">)</span></span>
<span><span class="va">biomarker_map</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">##   exposure_id biomarker_id</span></span>
<span><span class="co">##         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>           1            1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>           2            2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>           3            1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>           3            2</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="force-of-exposure-and-exposure-model">1.4 Force of Exposure and Exposure Model<a class="anchor" aria-label="anchor" href="#force-of-exposure-and-exposure-model"></a>
</h2>
<p>Now, we need to specify the foe_pars argument which contains the
force of exposure for all exposure_IDs across all time steps and groups.
We also need to specify the exposure model which will be called within
<em>runserosim</em> later. The exposure model will determine the
probability that an individual is exposed to a specific exposure
event.</p>
<p>We specified the same force of exposure for all time steps within
foe_pars for simplicity but users will likely have varying numbers to
match real world settings.</p>
<p>For our selected exposure model, the probability of exposure
(1-e^(-λ)) depends on the force of exposure (λ) at the current time t
for group g modulated by relevant demographic elements (dem_mod). For
simplicity, we selected arbitrary age and demography modifiers specified
below. Since we have two groups, there are 2 rows in the first foe_pars
dimension to specify the group specific force of exposure.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create an empty array to store the force of exposure for all exposure types across all time steps and groups</span></span>
<span><span class="co">## Dimension 1: Group</span></span>
<span><span class="co">## Dimension 2: Times</span></span>
<span><span class="co">## Dimension 3: Exposure ID in the numeric order that they appear in the biomarker map</span></span>
<span><span class="va">foe_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">demography</span><span class="op">$</span><span class="va">group</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">biomarker_map</span><span class="op">$</span><span class="va">exposure_id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Note that we can specify a different force of exposure for each group, time and exposure ID</span></span>
<span><span class="co">## We specified the same value for all time steps within foe_pars for simplicity.</span></span>
<span></span>
<span><span class="co">## Specify the force of exposure for exposure ID 1 which represents diphtheria natural infection (DP_ifxn)</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.04</span> <span class="co">## Group 1 (aka Location 1)</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span><span class="fl">2</span>,,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.03</span> <span class="co">## Group 2 (aka Location 2)</span></span>
<span></span>
<span><span class="co">## Specify the force of exposure for exposure ID 2 which represents pertussis natural infection (PT_ifxn)</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.02</span> <span class="co">## Group 1 (aka Location 1)</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span><span class="fl">2</span>,,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.01</span> <span class="co">## Group 2 (aka Location 2)</span></span>
<span></span>
<span><span class="co">## Specify the force of exposure for exposure ID 3 which represents diphtheria and pertussis combined vaccine (vacc)</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.02</span> <span class="co">## Group 1 (aka Location 1)</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span><span class="fl">2</span>,,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.03</span> <span class="co">## Group 2 (aka Location 2)</span></span>
<span></span>
<span><span class="co">## Specify a simple exposure model which calculates the probability of exposure from the force of exposure modulated by age and demography elements </span></span>
<span><span class="va">exposure_model</span><span class="op">&lt;-</span><span class="va">exposure_model_dem_mod</span></span>
<span></span>
<span><span class="co">## This exposure model requires dem_mod and t_in_year arguments</span></span>
<span></span>
<span><span class="co">## Create a tibble with any relevant demography modifiers that affect exposure probability </span></span>
<span><span class="co">## For simplicity, we selected arbitrary numbers. </span></span>
<span></span>
<span><span class="co">## First, we will specify age modifiers </span></span>
<span><span class="co">## Individuals who are 0-3 are 2 times more likely to be exposed to diphtheria</span></span>
<span><span class="va">age_mod_1</span><span class="op">&lt;-</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>exposure_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">11</span><span class="op">)</span>, column<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"age"</span>,times<span class="op">=</span><span class="fl">11</span><span class="op">)</span>, value<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span>, modifier<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Individuals who are 0-3 are 2 times more likely to be exposed to pertussis</span></span>
<span><span class="va">age_mod_2</span><span class="op">&lt;-</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>exposure_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">11</span><span class="op">)</span>, column<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"age"</span>,times<span class="op">=</span><span class="fl">11</span><span class="op">)</span>, value<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span>, modifier<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Individuals who are less than one year old are 3 times more likely be vaccinated than other age classes</span></span>
<span><span class="va">age_mod_3</span><span class="op">&lt;-</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>exposure_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">11</span><span class="op">)</span>, column<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"age"</span>,times<span class="op">=</span><span class="fl">11</span><span class="op">)</span>,  value<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span>, modifier<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">age_mod</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">age_mod_1</span>,<span class="va">age_mod_2</span>,<span class="va">age_mod_3</span><span class="op">)</span></span>
<span><span class="va">age_mod</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 33 × 4</span></span></span>
<span><span class="co">##    exposure_id column value modifier</span></span>
<span><span class="co">##          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>           1 age        0        2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>           1 age        1        2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>           1 age        2        2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>           1 age        3        2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>           1 age        4        1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>           1 age        5        1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>           1 age        6        1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>           1 age        7        1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>           1 age        8        1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>           1 age        9        1</span></span>
<span><span class="co">## <span style="color: #949494;"># … with 23 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Now we will  specify additional demography exposure modifiers and combine them with the previous ones</span></span>
<span><span class="co">## Here, individuals who are of low nutritional status are twice as likely of being exposed to diphtheria and pertussis while individuals who are of medium nutritional status are 1.5 times as likely of being exposed when compared to individuals of high nutritional status </span></span>
<span><span class="co">## Individuals of high nutritional status are 3 times more likely to be exposed to exposure ID 3 (vaccination) while individuals who are of medium nutritional status are 2 times more likely to be exposed to exposure ID 3 (vaccination) than individuals of low nutritional status. </span></span>
<span><span class="co">## Note that the modifiers must be defined for all combinations of exposure types and demographic elements</span></span>
<span><span class="va">mod</span><span class="op">&lt;-</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>exposure_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, column<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"NS"</span>,times<span class="op">=</span><span class="fl">9</span><span class="op">)</span>, value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>,<span class="st">"medium"</span>, <span class="st">"high"</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span>, modifier<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1.5</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 4</span></span></span>
<span><span class="co">##   exposure_id column value  modifier</span></span>
<span><span class="co">##         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>           1 NS     low         2  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>           1 NS     medium      1.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>           1 NS     high        1  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>           2 NS     low         2  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>           2 NS     medium      1.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>           2 NS     high        1  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span>           3 NS     low         1  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span>           3 NS     medium      2  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span>           3 NS     high        3</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Combine both age modifiers and additional modifiers</span></span>
<span><span class="va">dem_mod</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">age_mod</span>,<span class="va">mod</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Specify the number of time steps within a year which will be used to calculate an individual's age. </span></span>
<span><span class="co">## We are simulating on the monthly scale so there are 12 time steps within a year.</span></span>
<span><span class="va">t_in_year</span><span class="op">=</span><span class="fl">12</span></span>
<span></span>
<span><span class="co">## Examine the probability of exposure over time for the specified exposure model</span></span>
<span><span class="fu"><a href="../reference/plot_exposure_model.html">plot_exposure_model</a></span><span class="op">(</span>indivs<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,exposure_model<span class="op">=</span><span class="va">exposure_model_dem_mod</span>, times<span class="op">=</span><span class="va">times</span>, n_groups <span class="op">=</span> <span class="fl">2</span>, n_exposures <span class="op">=</span> <span class="fl">3</span>, foe_pars<span class="op">=</span><span class="va">foe_pars</span>, demography<span class="op">=</span><span class="va">demography</span>, dem_mod<span class="op">=</span><span class="va">dem_mod</span>,t_in_year<span class="op">=</span><span class="va">t_in_year</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_2_diphtheria_pertussis_files/figure-html/unnamed-chunk-6-1.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="immunity-model">1.5 Immunity Model<a class="anchor" aria-label="anchor" href="#immunity-model"></a>
</h2>
<p>Here, we specify the immunity model which will determine the
probability that an exposure event is successful in inducing an
immunological response. Since we have both vaccination and natural
infection events, we will use immunity_model_vacc_ifxn_biomarker_prot.
With this immunity model, the probability of successful vaccination
exposure depends on the number of vaccines received prior to time t and
the individual’s age at time t while the probability of successful
infection is dependent on the biomarker quantity, in this case antibody
titer, at the time of exposure. Individuals can have up to 3 successful
vaccination events (aka 3 doses) and are eligible for vaccination
starting at 2 months of age to align with the diphtheria/pertussis
vaccination schedule.</p>
<p>As for the probability of a successful infection, we placed no limit
on the maximum number of infections to either diphtheria or pertussis
however our selected immunity model will take into account an
individual’s current biomarker<br>
level when determining the probability of a successful infection.
Additional successful exposure events aka “reinfection” events are
representative of boosting events which can occur if an individual is
exposed to either pathogen following a vaccination or previous
infection. The user can limit the frequency of reinfections by adjusting
the biomarker-mediated protection (also known as titer-mediated
protection) parameters or by specifying a maximum number of allowed
successful exposure events. The titer-mediated protection parameters
used within this model are defined within model_pars which will be
loaded in section 1.6.</p>
<p>Again, the following diphtheria and pertussis titer-mediated
protection parameters were selected by a non-exhaustive literature
search. The titer cutoffs used below were also discussed in a previous
analysis of diphtheria and pertussis serology <span class="citation">(<a href="#ref-Razafimahatratra2022-ub" role="doc-biblioref">Razafimahatratra et al. 2022</a>)</span>.</p>
<p>Diphtheria: 1. Individuals whose diphtheria antibody levels are under
0.01 IU/mL are considered highly susceptible to disease while
individuals with higher levels are associated with less severe symptoms
<span class="citation">(<a href="#ref-Ipsen1946-qc" role="doc-biblioref">Ipsen 1946</a>; <a href="#ref-Bjorkholm1986-qk" role="doc-biblioref">Björkholm et al. 1986</a>; <a href="#ref-Danilova2006-vj" role="doc-biblioref">Danilova et al.
2006</a>; <a href="#ref-Ohuabunwo2005-rn" role="doc-biblioref">Ohuabunwo
et al. 2005</a>)</span>. 2. Individuals whose antibody levels are 0.01
IU/mL have the lowest titer level which confers some degree of
protection while individuals with &gt;=0.1 IU/mL are associated with
long term protection <span class="citation">(<a href="#ref-Efstratiou1994-xh" role="doc-biblioref">Efstratiou, Maple,
and World Health Organization. Regional Office for Europe
1994</a>,)</span>. 3. Antibody levels in between 0.01 and 0.09 IU/mL are
considered to provide basic levels of protection against disease <span class="citation">(<a href="#ref-World_Health_Organization2017-hc" role="doc-biblioref">World Health Organization 2017</a>)</span>.</p>
<p>Pertussis: 1. Low anti-pertussis IgG antibodies have shown
significant correlation with pertussis susceptibility <span class="citation">(<a href="#ref-Storsaeter2003-uk" role="doc-biblioref">Storsaeter et al. 2003</a>)</span> but a protective
threshold has not been established <span class="citation">(<a href="#ref-Saso2020-gd" role="doc-biblioref">Saso and Kampmann
2020</a>)</span> since there is no established immunological correlate
of protection against disease <span class="citation">(<a href="#ref-Plotkin2008-oi" role="doc-biblioref">Plotkin
2008</a>)</span>. 2. Given the information presented above, we have
chosen that antibody levels between 40-100 IU/mL will confer higher
level of protection since they are indicative of serpositivity and of
recent pertussis infection or pertussis vaccination <span class="citation">(<a href="#ref-noauthor_undated-hp" role="doc-biblioref"><span>“<span>BORDG</span> - Overview: Bordetella
Pertussis Antibody, <span>IgG</span>, Serum,”</span> n.d.</a>; <a href="#ref-Chen2016-ka" role="doc-biblioref">Chen et al.
2016</a>)</span>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify immunity model within the runserosim function below </span></span>
<span><span class="va">immunity_model</span><span class="op">&lt;-</span><span class="va">immunity_model_vacc_ifxn_biomarker_prot</span></span>
<span></span>
<span><span class="co">## Specify which exposure IDs represent vaccination events </span></span>
<span><span class="co">## In this case, only exposure ID 3 is a vaccination event</span></span>
<span><span class="va">vacc_exposures</span><span class="op">&lt;-</span><span class="fl">3</span></span>
<span></span>
<span><span class="co">## Specify the time step after birth at which an individual is eligible for vaccination (2 months old for diphtheria and pertussis combine vaccine); ; note non-vaccine exposures are listed as NAs</span></span>
<span><span class="va">vacc_age</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="cn">NA</span>,<span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Specify the maximum number of successful exposure events an individual can receive for each exposure type</span></span>
<span><span class="co">## We placed no successful exposure limit on the number of diphtheria or pertussis infection exposures and 3 dose limit on the vaccine exposure.</span></span>
<span><span class="va">max_events</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">Inf</span>,<span class="cn">Inf</span>,<span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Plot biomarker-mediated protection curve given parameters specified within model_pars for biomarker 1, diphtheria antibody  (DP_antibody) which will be loaded in section 1.6</span></span>
<span><span class="co">## The immunity model we selected will take into account an individual's current titer to diphtheria when determining the probability of successful infection. </span></span>
<span><span class="co">## Titers are ploted in mIU/mL </span></span>
<span><span class="fu"><a href="../reference/plot_biomarker_mediated_protection.html">plot_biomarker_mediated_protection</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">150</span>, biomarker_prot_midpoint<span class="op">=</span><span class="fl">75</span>, biomarker_prot_width<span class="op">=</span><span class="fl">.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_2_diphtheria_pertussis_files/figure-html/unnamed-chunk-7-1.png" width="384"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot biomarker-mediated protection curve given parameters specified within model_pars for biomarker 2, pertussis antibody (PT_antibody) which will be loaded in section 1.6</span></span>
<span><span class="co">## The immunity model we selected will take into account an individual's current titer to pertussis when determining the probability of successful infection. </span></span>
<span><span class="co">## Titers are ploted in IU/mL </span></span>
<span><span class="fu"><a href="../reference/plot_biomarker_mediated_protection.html">plot_biomarker_mediated_protection</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">100</span>, biomarker_prot_midpoint<span class="op">=</span><span class="fl">40</span>, biomarker_prot_width<span class="op">=</span><span class="fl">.25</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_2_diphtheria_pertussis_files/figure-html/unnamed-chunk-7-2.png" width="384"></p>
</div>
<div class="section level2">
<h2 id="antibody-model-and-model-parameters">1.6 Antibody model and model parameters<a class="anchor" aria-label="anchor" href="#antibody-model-and-model-parameters"></a>
</h2>
<p>Now, we specify the antibody model to be used within
<em>runserosim</em> to track antibody kinetics, or more broadly
biomarker kinetics for each biomarker produced from successful exposure
events. We will be using a biphasic boosting-waning model. This model
assumes that for each exposure there is a set of long-term boost,
long-term boost waning, short-term boost, and short-term boost waning
parameters. Given varying diphtheria antibody dynamics observed in early
and late life, we decided that a biphasic boosting-waning model was
appropriate for our purposes <span class="citation">(<a href="#ref-Voysey2016-gu" role="doc-biblioref">Voysey et al.
2016</a>)</span>.</p>
<p>The antibody kinetics parameters needed for the antibody model are
pre-loaded within a csv file which will take on the argument name:
model_pars. Users can edit the csv file to modify any parameters.
<em>runserosim</em> requires that exposure_id and biomarker_id are
numeric within model_pars so we will use the reformat_biomarker_map
function again to create a new version of model_pars. Users can go
directly to numeric model_pars if they wish.</p>
<p>We selected a few diphtheria and pertussis serological surveys
conducted which reported IgG titers following vaccination to inform the
vaccine induced boost and waning parameters. There are many complexities
and heterogeneity in these parameters which arise from different vaccine
types and vaccination schedules. We neglect these complexities and
select a few papers to give us some rough parameters for this example
simulation.</p>
<p>After 3 vaccine doses, diphtheria titers ranged 1.5-1.7 IU/mL <span class="citation">(<a href="#ref-Kimura1991-pg" role="doc-biblioref">Kimura et al. 1991</a>)</span> and pertussis titers
above 100 IU/mL are associated with recent vaccination <span class="citation">(<a href="#ref-noauthor_undated-hp" role="doc-biblioref"><span>“<span>BORDG</span> - Overview: Bordetella
Pertussis Antibody, <span>IgG</span>, Serum,”</span> n.d.</a>)</span>.
Diphtheria antibody half-life has been estimated to be around 19-27
years <span class="citation">(<a href="#ref-Amanna2007-pf" role="doc-biblioref">Amanna, Carlson, and Slifka 2007</a>; <a href="#ref-Hammarlund2016-lj" role="doc-biblioref">Hammarlund et al.
2016</a>)</span> with 10% of children losing immunity by one year
following the primary vaccination series <span class="citation">(<a href="#ref-Pichichero1987-sl" role="doc-biblioref">Pichichero et al.
1987</a>)</span>; 67% of children after 3 to 13 years and 83% after 14
to 23 years <span class="citation">(<a href="#ref-Crossley1979-ta" role="doc-biblioref">Crossley et al. 1979</a>)</span>. As for pertussis,
the duration of immunity after a 3 dose series of the wP vaccine is
estimated to be from 4 to 12 years <span class="citation">(<a href="#ref-Sheridan2014-fo" role="doc-biblioref">Sheridan et al.
2014</a>)</span>. Pertussis titers &gt;=100 IU/mL are associated with
recent infection or vaccination within the past year while titers
between 40 and 100 IU/mL are associated with recent infection <span class="citation">(<a href="#ref-noauthor_undated-hp" role="doc-biblioref"><span>“<span>BORDG</span> - Overview: Bordetella
Pertussis Antibody, <span>IgG</span>, Serum,”</span>
n.d.</a>)</span></p>
<p>Our selected antibody kinetics parameters given our brief and limited
literature search are as follows:</p>
<p>Diphtheria vaccine: Long term boost: 0.3-0.5 IU/mL Long term boost
waning: 0.01 IU/mL per month Short term boost: 0.1-0.3 IU/mL Short term
boost waning: 0.033 IU/mL per month</p>
<p>Pertussis vaccine: Long term boost: 30-50 IU/mL Long term boost
waning: 0.0066 IU/mL per month Short term boost: 40-80 IU/mL Short term
boost waning: 0.016 IU/mL per month</p>
<p>We were unable to find studies that reported titer kinetics following
known infection events in comparable units. For simplicity, we will
assume that natural infection boosting parameters are 25% higher than
vaccine induced antibody boosting with similar waning rates.</p>
<p>Lastly, we define the draw_parameters function which determines how
each individual’s antibody kinetics parameters are simulated from the
within-host processes parameters tibble (model_pars). We will use a
function which draws parameters directly from model_pars for the
antibody model with random effects to represent individual heterogeneity
in immunological responses. Parameters are drawn randomly from a
distribution with mean and standard deviation specified within
model_pars. This draw_parameters function also incorporates biomarker
quantitiy dependent boosting (also known as titer-dependent boosting)
where an individual’s realized boost is dependent on their titer level
at the time of the exposure event.</p>
<p>We arbitrarily set the diphtheria titer-dependent boosting effects
following an additional successful exposure event for individuals with
diphtheria levels above 1.7 IU/mL to be only 10% of the full boost.
Similarly, individuals with pertussis titers above 100 IU/mL will only
receive 10% of the full boost for any additional successful exposure
event.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the antibody model </span></span>
<span><span class="va">antibody_model</span><span class="op">&lt;-</span><span class="va">antibody_model_biphasic</span></span>
<span></span>
<span><span class="co">## Bring in the antibody parameters needed for the antibody model </span></span>
<span><span class="co">## Note that the titer-mediated protection parameters needed for the immunity model, the titer-ceiling parameters needed for draw_parameters and the observation error parameter needed for the observation model are all defined here too.</span></span>
<span><span class="co">## Also note that these are all arbitrary parameter values chosen for this toy example.</span></span>
<span><span class="va">model_pars_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"model_pars_cs2.csv"</span>, package <span class="op">=</span> <span class="st">"serosim"</span><span class="op">)</span></span>
<span><span class="va">model_pars_original</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">model_pars_path</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">model_pars_original</span> </span></code></pre></div>
<pre><code><span><span class="co">##    exposure_id biomarker_id                        name       mean    sd</span></span>
<span><span class="co">## 1         vacc  DP_antibody                  boost_long   0.400000 1e-01</span></span>
<span><span class="co">## 2         vacc  DP_antibody                 boost_short   0.200000 1e-01</span></span>
<span><span class="co">## 3         vacc  DP_antibody                   wane_long   0.010000 5e-03</span></span>
<span><span class="co">## 4         vacc  DP_antibody                  wane_short   0.033000 5e-03</span></span>
<span><span class="co">## 5         vacc  DP_antibody biomarker_ceiling_threshold   1.700000    NA</span></span>
<span><span class="co">## 6         vacc  DP_antibody  biomarker_ceiling_gradient   0.529411    NA</span></span>
<span><span class="co">## 7         &lt;NA&gt;  DP_antibody                      obs_sd         NA 5e-02</span></span>
<span><span class="co">## 8         vacc  PT_antibody                  boost_long  40.000000 1e+01</span></span>
<span><span class="co">## 9         vacc  PT_antibody                 boost_short  60.000000 2e+01</span></span>
<span><span class="co">## 10        vacc  PT_antibody                   wane_long   0.006600 5e-04</span></span>
<span><span class="co">## 11        vacc  PT_antibody                  wane_short   0.016000 5e-04</span></span>
<span><span class="co">## 12        vacc  PT_antibody biomarker_ceiling_threshold 100.000000    NA</span></span>
<span><span class="co">## 13        vacc  PT_antibody  biomarker_ceiling_gradient   0.009000    NA</span></span>
<span><span class="co">## 14        &lt;NA&gt;  PT_antibody                      obs_sd         NA 1e+01</span></span>
<span><span class="co">## 15     DP_ifxn  DP_antibody                  boost_long   0.500000 1e-01</span></span>
<span><span class="co">## 16     DP_ifxn  DP_antibody                 boost_short   0.250000 1e-01</span></span>
<span><span class="co">## 17     DP_ifxn  DP_antibody                   wane_long   0.010000 5e-03</span></span>
<span><span class="co">## 18     DP_ifxn  DP_antibody                  wane_short   0.033000 5e-03</span></span>
<span><span class="co">## 19     DP_ifxn  DP_antibody biomarker_ceiling_threshold   1.700000    NA</span></span>
<span><span class="co">## 20     DP_ifxn  DP_antibody  biomarker_ceiling_gradient   0.529411    NA</span></span>
<span><span class="co">## 21     DP_ifxn  DP_antibody     biomarker_prot_midpoint   0.075000    NA</span></span>
<span><span class="co">## 22     DP_ifxn  DP_antibody        biomarker_prot_width   0.100000    NA</span></span>
<span><span class="co">## 23     PT_ifxn  PT_antibody                  boost_long  50.000000 1e+01</span></span>
<span><span class="co">## 24     PT_ifxn  PT_antibody                 boost_short  75.000000 2e+01</span></span>
<span><span class="co">## 25     PT_ifxn  PT_antibody                   wane_long   0.006600 5e-04</span></span>
<span><span class="co">## 26     PT_ifxn  PT_antibody                  wane_short   0.016000 5e-04</span></span>
<span><span class="co">## 27     PT_ifxn  PT_antibody biomarker_ceiling_threshold 100.000000    NA</span></span>
<span><span class="co">## 28     PT_ifxn  PT_antibody  biomarker_ceiling_gradient   0.009000    NA</span></span>
<span><span class="co">## 29     PT_ifxn  PT_antibody     biomarker_prot_midpoint  40.000000    NA</span></span>
<span><span class="co">## 30     PT_ifxn  PT_antibody        biomarker_prot_width   0.250000    NA</span></span>
<span><span class="co">##    distribution</span></span>
<span><span class="co">## 1    log-normal</span></span>
<span><span class="co">## 2    log-normal</span></span>
<span><span class="co">## 3    log-normal</span></span>
<span><span class="co">## 4    log-normal</span></span>
<span><span class="co">## 5              </span></span>
<span><span class="co">## 6              </span></span>
<span><span class="co">## 7        normal</span></span>
<span><span class="co">## 8    log-normal</span></span>
<span><span class="co">## 9    log-normal</span></span>
<span><span class="co">## 10   log-normal</span></span>
<span><span class="co">## 11   log-normal</span></span>
<span><span class="co">## 12             </span></span>
<span><span class="co">## 13             </span></span>
<span><span class="co">## 14       normal</span></span>
<span><span class="co">## 15   log-normal</span></span>
<span><span class="co">## 16   log-normal</span></span>
<span><span class="co">## 17   log-normal</span></span>
<span><span class="co">## 18   log-normal</span></span>
<span><span class="co">## 19             </span></span>
<span><span class="co">## 20             </span></span>
<span><span class="co">## 21             </span></span>
<span><span class="co">## 22             </span></span>
<span><span class="co">## 23   log-normal</span></span>
<span><span class="co">## 24   log-normal</span></span>
<span><span class="co">## 25   log-normal</span></span>
<span><span class="co">## 26   log-normal</span></span>
<span><span class="co">## 27             </span></span>
<span><span class="co">## 28             </span></span>
<span><span class="co">## 29             </span></span>
<span><span class="co">## 30</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Reformat model_pars for runserosim</span></span>
<span><span class="va">model_pars</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/reformat_biomarker_map.html">reformat_biomarker_map</a></span><span class="op">(</span><span class="va">model_pars_original</span><span class="op">)</span></span>
<span><span class="va">model_pars</span></span></code></pre></div>
<pre><code><span><span class="co">##    exposure_id biomarker_id                        name       mean    sd</span></span>
<span><span class="co">## 1            3            1                  boost_long   0.400000 1e-01</span></span>
<span><span class="co">## 2            3            1                 boost_short   0.200000 1e-01</span></span>
<span><span class="co">## 3            3            1                   wane_long   0.010000 5e-03</span></span>
<span><span class="co">## 4            3            1                  wane_short   0.033000 5e-03</span></span>
<span><span class="co">## 5            3            1 biomarker_ceiling_threshold   1.700000    NA</span></span>
<span><span class="co">## 6            3            1  biomarker_ceiling_gradient   0.529411    NA</span></span>
<span><span class="co">## 7           NA            1                      obs_sd         NA 5e-02</span></span>
<span><span class="co">## 8            3            2                  boost_long  40.000000 1e+01</span></span>
<span><span class="co">## 9            3            2                 boost_short  60.000000 2e+01</span></span>
<span><span class="co">## 10           3            2                   wane_long   0.006600 5e-04</span></span>
<span><span class="co">## 11           3            2                  wane_short   0.016000 5e-04</span></span>
<span><span class="co">## 12           3            2 biomarker_ceiling_threshold 100.000000    NA</span></span>
<span><span class="co">## 13           3            2  biomarker_ceiling_gradient   0.009000    NA</span></span>
<span><span class="co">## 14          NA            2                      obs_sd         NA 1e+01</span></span>
<span><span class="co">## 15           1            1                  boost_long   0.500000 1e-01</span></span>
<span><span class="co">## 16           1            1                 boost_short   0.250000 1e-01</span></span>
<span><span class="co">## 17           1            1                   wane_long   0.010000 5e-03</span></span>
<span><span class="co">## 18           1            1                  wane_short   0.033000 5e-03</span></span>
<span><span class="co">## 19           1            1 biomarker_ceiling_threshold   1.700000    NA</span></span>
<span><span class="co">## 20           1            1  biomarker_ceiling_gradient   0.529411    NA</span></span>
<span><span class="co">## 21           1            1     biomarker_prot_midpoint   0.075000    NA</span></span>
<span><span class="co">## 22           1            1        biomarker_prot_width   0.100000    NA</span></span>
<span><span class="co">## 23           2            2                  boost_long  50.000000 1e+01</span></span>
<span><span class="co">## 24           2            2                 boost_short  75.000000 2e+01</span></span>
<span><span class="co">## 25           2            2                   wane_long   0.006600 5e-04</span></span>
<span><span class="co">## 26           2            2                  wane_short   0.016000 5e-04</span></span>
<span><span class="co">## 27           2            2 biomarker_ceiling_threshold 100.000000    NA</span></span>
<span><span class="co">## 28           2            2  biomarker_ceiling_gradient   0.009000    NA</span></span>
<span><span class="co">## 29           2            2     biomarker_prot_midpoint  40.000000    NA</span></span>
<span><span class="co">## 30           2            2        biomarker_prot_width   0.250000    NA</span></span>
<span><span class="co">##    distribution</span></span>
<span><span class="co">## 1    log-normal</span></span>
<span><span class="co">## 2    log-normal</span></span>
<span><span class="co">## 3    log-normal</span></span>
<span><span class="co">## 4    log-normal</span></span>
<span><span class="co">## 5              </span></span>
<span><span class="co">## 6              </span></span>
<span><span class="co">## 7        normal</span></span>
<span><span class="co">## 8    log-normal</span></span>
<span><span class="co">## 9    log-normal</span></span>
<span><span class="co">## 10   log-normal</span></span>
<span><span class="co">## 11   log-normal</span></span>
<span><span class="co">## 12             </span></span>
<span><span class="co">## 13             </span></span>
<span><span class="co">## 14       normal</span></span>
<span><span class="co">## 15   log-normal</span></span>
<span><span class="co">## 16   log-normal</span></span>
<span><span class="co">## 17   log-normal</span></span>
<span><span class="co">## 18   log-normal</span></span>
<span><span class="co">## 19             </span></span>
<span><span class="co">## 20             </span></span>
<span><span class="co">## 21             </span></span>
<span><span class="co">## 22             </span></span>
<span><span class="co">## 23   log-normal</span></span>
<span><span class="co">## 24   log-normal</span></span>
<span><span class="co">## 25   log-normal</span></span>
<span><span class="co">## 26   log-normal</span></span>
<span><span class="co">## 27             </span></span>
<span><span class="co">## 28             </span></span>
<span><span class="co">## 29             </span></span>
<span><span class="co">## 30</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the draw_parameters function to use </span></span>
<span><span class="va">draw_parameters</span><span class="op">&lt;-</span><span class="va">draw_parameters_random_fx_biomarker_dep</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot biomarker (in this case antibody titer) dependent boosting effects given parameters specified within model_pars for biomarker 1, diphtheria antibody (DP_antibody)</span></span>
<span><span class="fu"><a href="../reference/plot_biomarker_dependent_boosting.html">plot_biomarker_dependent_boosting</a></span><span class="op">(</span>start<span class="op">=</span><span class="fl">0</span>, end<span class="op">=</span><span class="fl">2</span>, by<span class="op">=</span><span class="fl">.1</span>, biomarker_ceiling_threshold<span class="op">=</span><span class="fl">1.7</span>, biomarker_ceiling_gradient<span class="op">=</span><span class="fl">0.529411</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_2_diphtheria_pertussis_files/figure-html/unnamed-chunk-9-1.png" width="480"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot biomarker (in this case antibody titer) dependent boosting effects given parameters specified within model_pars for biomarker 2, pertussis antibody (PT_antibody)</span></span>
<span><span class="fu"><a href="../reference/plot_biomarker_dependent_boosting.html">plot_biomarker_dependent_boosting</a></span><span class="op">(</span>start<span class="op">=</span><span class="fl">0</span>, end<span class="op">=</span><span class="fl">125</span>, by<span class="op">=</span><span class="fl">1</span>, biomarker_ceiling_threshold<span class="op">=</span><span class="fl">100</span>, biomarker_ceiling_gradient<span class="op">=</span><span class="fl">0.009</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_2_diphtheria_pertussis_files/figure-html/unnamed-chunk-9-2.png" width="480"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot example biomarker trajectories given the specified antibody kinetics model, model parameters and draw parameters function </span></span>
<span><span class="fu"><a href="../reference/plot_antibody_model.html">plot_antibody_model</a></span><span class="op">(</span><span class="va">antibody_model_biphasic</span>, N<span class="op">=</span><span class="fl">25</span>, model_pars<span class="op">=</span><span class="va">model_pars</span>,draw_parameters_fn <span class="op">=</span> <span class="va">draw_parameters_random_fx_biomarker_dep</span>, biomarker_map<span class="op">=</span><span class="va">biomarker_map</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_2_diphtheria_pertussis_files/figure-html/unnamed-chunk-9-3.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="observation-model">1.7 Observation Model<a class="anchor" aria-label="anchor" href="#observation-model"></a>
</h2>
<p>Now we specify how observed biomarker quantities, in this case
antibody titers, are generated as a probabilistic function of the true,
latent biomarker quantities, and when to observe these quantities. In
this step, users are specifying the sampling design and assay choice for
their serological survey.</p>
<p>This observation model observes the latent titer values given a
continuous assay with user-specified lower and upper limits, added
noise. The added noise represents assay variability and is done by
sampling from a distribution with the latent antibody titer as the mean
and the measurement error as the standard deviation. The observation
standard deviation and distribution is defined within model_pars as the
“obs_sd” parameter for each biomarker.</p>
<p>Diphtheria: Lower limit of ELISA IgG Detectability: 0.01 IU/mL Upper
limit of ELISA IgG Detectability: 2 IU/mL</p>
<p>Pertussis: Lower limit of ELISA IgG Detectability: 5 IU/mL Upper
limit of ELISA IgG Detectability: 200 IU/mL</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the limits of detection for each biomarker for the continuous assays</span></span>
<span><span class="va">bounds</span><span class="op">&lt;-</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>biomarker_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>,name<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lower_bound"</span>,<span class="st">"upper_bound"</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span>,value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">2</span>,<span class="fl">5</span>,<span class="fl">200</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Specify the observation model </span></span>
<span><span class="va">observation_model</span><span class="op">&lt;-</span><span class="va">observation_model_continuous_bounded_noise</span></span>
<span></span>
<span><span class="co">## Specify observation_times to observe both biomarkers (aka DP_antibody and PT_antibody titers) across all individuals at the end of the simulation (t=120)</span></span>
<span><span class="va">obs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>i<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>,t<span class="op">=</span><span class="fl">120</span>, b<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">obs2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>i<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>,t<span class="op">=</span><span class="fl">120</span>, b<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">observation_times</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">obs1</span>,<span class="va">obs2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="optional-arguments">1.8 Optional Arguments<a class="anchor" aria-label="anchor" href="#optional-arguments"></a>
</h2>
<p>There are no optional arguments needed for this simulation.</p>
</div>
<div class="section level2">
<h2 id="run-simulation">1.9 Run Simulation<a class="anchor" aria-label="anchor" href="#run-simulation"></a>
</h2>
<p>This is the core simulation where all simulation settings, models and
parameters are specified within the main simulation function. The run
time for this step varies depending on the number of individuals and the
complexities of the specified models. There is a built in
pre-computation step within <em>runserosim</em> where the simulation
attempts to perform as much pre-computation as possible for the exposure
model to speed up the main simulation code. Users can turn off this
pre-computation by setting pre-computation to FALSE within
<em>runserosim</em>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/runserosim.html">runserosim</a></span><span class="op">(</span></span>
<span>  <span class="va">simulation_settings</span>,</span>
<span>  <span class="va">demography</span>,</span>
<span>  <span class="va">observation_times</span>,</span>
<span>  <span class="va">foe_pars</span>,</span>
<span>  <span class="va">biomarker_map</span>,</span>
<span>  <span class="va">model_pars</span>,</span>
<span>  <span class="va">exposure_model</span>,</span>
<span>  <span class="va">immunity_model</span>,</span>
<span>  <span class="va">antibody_model</span>,</span>
<span>  <span class="va">observation_model</span>,</span>
<span>  <span class="va">draw_parameters</span>,</span>
<span></span>
<span>  <span class="co">## Other arguments needed</span></span>
<span>  bounds<span class="op">=</span><span class="va">bounds</span>,</span>
<span>  max_events<span class="op">=</span><span class="va">max_events</span>,</span>
<span>  vacc_exposures<span class="op">=</span><span class="va">vacc_exposures</span>,</span>
<span>  vacc_age<span class="op">=</span><span class="va">vacc_age</span>,</span>
<span>  dem_mod<span class="op">=</span><span class="va">dem_mod</span>,</span>
<span>  t_in_year<span class="op">=</span><span class="va">t_in_year</span>,</span>
<span>  VERBOSE<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>  attempt_precomputation <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Note that models and arguments specified earlier in the code can be specified directly within this function.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generate-plots">1.10 Generate Plots<a class="anchor" aria-label="anchor" href="#generate-plots"></a>
</h2>
<p>Now that the simulation is complete, let’s plot and examine the
simulation outputs.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot diphtheria biomarker kinetics and exposure histories for 10 individuals </span></span>
<span><span class="fu"><a href="../reference/plot_subset_individuals_history.html">plot_subset_individuals_history</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">biomarker_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">b</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>, <span class="va">res</span><span class="op">$</span><span class="va">exposure_histories_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">x</span><span class="op">==</span><span class="fl">1</span> <span class="op">|</span> <span class="va">x</span><span class="op">==</span><span class="fl">3</span><span class="op">)</span>, subset<span class="op">=</span><span class="fl">10</span>, <span class="va">demography</span>, removal<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 100 rows containing missing values (`geom_line()`).</span></span></code></pre>
<p><img src="case_study_2_diphtheria_pertussis_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot pertussis biomarker kinetics and exposure histories for 10 individuals </span></span>
<span><span class="fu"><a href="../reference/plot_subset_individuals_history.html">plot_subset_individuals_history</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">biomarker_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">b</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span>, <span class="va">res</span><span class="op">$</span><span class="va">exposure_histories_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">x</span><span class="op">==</span><span class="fl">2</span> <span class="op">|</span> <span class="va">x</span><span class="op">==</span><span class="fl">3</span><span class="op">)</span>, subset<span class="op">=</span><span class="fl">10</span>, <span class="va">demography</span>, removal<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 61 rows containing missing values (`geom_line()`).</span></span></code></pre>
<p><img src="case_study_2_diphtheria_pertussis_files/figure-html/unnamed-chunk-13-1.png" width="576"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot individual probability of exposure for all exposure types.</span></span>
<span><span class="co">## This is the output of the exposure model.</span></span>
<span><span class="fu"><a href="../reference/plot_exposure_force.html">plot_exposure_force</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">exposure_force_long</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_2_diphtheria_pertussis_files/figure-html/unnamed-chunk-14-1.png" width="480"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot individual successful exposure probabilities for all exposure types</span></span>
<span><span class="co">## This is the output of the exposure model multiplied by the output of the immunity model.</span></span>
<span><span class="co">## In other words, this is the probability of exposure event being successful and inducing an immunological response</span></span>
<span><span class="fu"><a href="../reference/plot_exposure_prob.html">plot_exposure_prob</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">exposure_probabilities_long</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_2_diphtheria_pertussis_files/figure-html/unnamed-chunk-15-1.png" width="480"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot individual exposure histories for all exposure types</span></span>
<span><span class="fu"><a href="../reference/plot_exposure_histories.html">plot_exposure_histories</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">exposure_histories_long</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_2_diphtheria_pertussis_files/figure-html/unnamed-chunk-16-1.png" width="480"></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot diphtheria antibody (biomarker 1) states for all individuals (true biomarker quantities)</span></span>
<span><span class="fu"><a href="../reference/plot_biomarker_quantity.html">plot_biomarker_quantity</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">biomarker_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">b</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_2_diphtheria_pertussis_files/figure-html/unnamed-chunk-17-1.png" width="384"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot pertussis antibody (biomarker 2) states for all individuals (true biomarker quantities)</span></span>
<span><span class="fu"><a href="../reference/plot_biomarker_quantity.html">plot_biomarker_quantity</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">biomarker_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">b</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_2_diphtheria_pertussis_files/figure-html/unnamed-chunk-18-1.png" width="384"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot the diphtheria serosurvey results (observed biomarker quantities)</span></span>
<span><span class="fu"><a href="../reference/plot_obs_biomarkers_one_sample.html">plot_obs_biomarkers_one_sample</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">observed_biomarker_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">b</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_2_diphtheria_pertussis_files/figure-html/unnamed-chunk-19-1.png" width="384"></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot the pertussis serosurvey results (observed biomarker quantities)</span></span>
<span><span class="fu"><a href="../reference/plot_obs_biomarkers_one_sample.html">plot_obs_biomarkers_one_sample</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">observed_biomarker_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">b</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_2_diphtheria_pertussis_files/figure-html/unnamed-chunk-20-1.png" width="384"></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Note that the simulated kinetics parameters are also stored</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">kinetics_parameters</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">##       i     t     x     b name                            value realized_value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1    55     2     2 boost_long                   48.7           48.7    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     1    55     2     2 boost_short                  53.1           53.1    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     1    55     2     2 wane_long                     0.006<span style="text-decoration: underline;">82</span>        0.006<span style="text-decoration: underline;">82</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     1    55     2     2 wane_short                    0.016<span style="text-decoration: underline;">6</span>         0.016<span style="text-decoration: underline;">6</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>     1    55     2     2 biomarker_ceiling_threshold 100            100      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>     1    55     2     2 biomarker_ceiling_gradient    0.009          0.009</span></span></code></pre>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Amanna2007-pf" class="csl-entry">
Amanna, Ian J, Nichole E Carlson, and Mark K Slifka. 2007.
<span>“Duration of Humoral Immunity to Common Viral and Vaccine
Antigens.”</span> <em>N. Engl. J. Med.</em> 357 (19): 1903–15.
</div>
<div id="ref-Bjorkholm1986-qk" class="csl-entry">
Björkholm, B, M Böttiger, B Christenson, and L Hagberg. 1986.
<span>“Antitoxin Antibody Levels and the Outcome of Illness During an
Outbreak of Diphtheria Among Alcoholics.”</span> <em>Scand. J. Infect.
Dis.</em> 18 (3): 235–39.
</div>
<div id="ref-noauthor_undated-hp" class="csl-entry">
<span>“<span>BORDG</span> - Overview: Bordetella Pertussis Antibody,
<span>IgG</span>, Serum.”</span> n.d. <a href="https://www.mayocliniclabs.com/test-catalog/overview/64780" class="external-link uri">https://www.mayocliniclabs.com/test-catalog/overview/64780</a>.
</div>
<div id="ref-Chen2016-ka" class="csl-entry">
Chen, Zhiyun, Jing Zhang, Lina Cao, Nan Zhang, Junping Zhu, Guoling
Ping, Jianhong Zhao, Shuming Li, and Qiushui He. 2016.
<span>“Seroprevalence of Pertussis Among Adults in China Where Whole
Cell Vaccines Have Been Used for 50 Years.”</span> <em>J. Infect.</em>
73 (1): 38–44.
</div>
<div id="ref-Crossley1979-ta" class="csl-entry">
Crossley, K, P Irvine, J B Warren, B K Lee, and K Mead. 1979.
<span>“Tetanus and Diphtheria Immunity in Urban Minnesota
Adults.”</span> <em>JAMA</em> 242 (21): 2298–2300.
</div>
<div id="ref-Danilova2006-vj" class="csl-entry">
Danilova, Elena, Pål A Jenum, Vegard Skogen, Valentin F Pilnikov, and
Haakon Sjursen. 2006. <span>“Antidiphtheria Antibody Responses in
Patients and Carriers of Corynebacterium Diphtheriae in the Arkhangelsk
Region of Russia.”</span> <em>Clin. Vaccine Immunol.</em> 13 (6):
627–32.
</div>
<div id="ref-Efstratiou1994-xh" class="csl-entry">
Efstratiou, Androulla, Christopher P A Maple, and World Health
Organization. Regional Office for Europe. 1994. <span>“Laboratory
Diagnosis of Diphtheria / by Androulla Efstratiou and p. A. Christopher
Maple.”</span> ICP/EPI 038(C). Copenhagen : WHO Regional Office for
Europe.
</div>
<div id="ref-Hammarlund2016-lj" class="csl-entry">
Hammarlund, Erika, Archana Thomas, Elizabeth A Poore, Ian J Amanna, Abby
E Rynko, Motomi Mori, Zunqiu Chen, and Mark K Slifka. 2016.
<span>“Durability of <span>Vaccine-Induced</span> Immunity Against
Tetanus and Diphtheria Toxins: A Cross-Sectional Analysis.”</span>
<em>Clin. Infect. Dis.</em> 62 (9): 1111–18.
</div>
<div id="ref-Ipsen1946-qc" class="csl-entry">
Ipsen, J. 1946. <span>“Circulating Antitoxin at the Onset of Diphtheria
in 425 Patients.”</span> <em>J. Immunol.</em> 54 (4): 325–47.
</div>
<div id="ref-Kimura1991-pg" class="csl-entry">
Kimura, M, H Kuno-Sakai, Y Sato, H Kamiya, R Nii, S Isomura, K Horiuchi,
T Kato, M Deguchi, and H Saikusa. 1991. <span>“A Comparative Trial of
the Reactogenicity and Immunogenicity of Takeda Acellular Pertussis
Vaccine Combined with Tetanus and Diphtheria Toxoids. Outcome in 3- to
8-Month-Old Infants, 9- to 23-Month-Old Infants and Children, and 24- to
30-Month-Old Children.”</span> <em>Am. J. Dis. Child.</em> 145 (7):
734–41.
</div>
<div id="ref-Ohuabunwo2005-rn" class="csl-entry">
Ohuabunwo, Chima, Jurijs Perevoscikovs, Aija Griskevica, Paul Gargiullo,
Anita Brilla, Ludmila Viksna, Steffen Glismann, Melinda Wharton, and
Charles Vitek. 2005. <span>“Respiratory Diphtheria Among Highly
Vaccinated Military Trainees in Latvia: Improved Protection from
<span>DT</span> Compared with Td Booster Vaccination.”</span> <em>Scand.
J. Infect. Dis.</em> 37 (11-12): 813–20.
</div>
<div id="ref-Pichichero1987-sl" class="csl-entry">
Pichichero, Michael E, Thomas J Badgett, George C Rodgers Jr, Samuel
Mclinn, Blanca Trevino-Scatterday, and John D Nelson. 1987.
<span>“Acellular Pertussis Vaccine: Immunogenicity and Safety of an
Acellular Pertussisvs.a Whole Cell Pertussis Vaccine Combined with
Diphtheria and Tetanus Toxoids as a Booster in 18- to 24-Month Old
Children.”</span> <em>Pediatr. Infect. Dis. J.</em> 6 (4): 352.
</div>
<div id="ref-Plotkin2008-oi" class="csl-entry">
Plotkin, Stanley A. 2008. <span>“Vaccines: Correlates of Vaccine-Induced
Immunity.”</span> <em>Clin. Infect. Dis.</em> 47 (3): 401–9.
</div>
<div id="ref-Razafimahatratra2022-ub" class="csl-entry">
Razafimahatratra, Solohery L, Arthur Menezes, Amy Wesolowski, Lala
Rafetrarivony, Simon Cauchemez, Richter Razafindratsimandresy, Aina
Harimanana, Tania Crucitti, Jean Marc Collard, and C J E Metcalf. 2022.
<span>“Leveraging Serology to Titrate Immunisation Programme
Functionality for Diphtheria in Madagascar.”</span> <em>Epidemiology
&amp; Infection</em> 150.
</div>
<div id="ref-Saso2020-gd" class="csl-entry">
Saso, Anja, and Beate Kampmann. 2020. <span>“Maternal Immunization:
Nature Meets Nurture.”</span> <em>Front. Microbiol.</em> 11 (July):
1499.
</div>
<div id="ref-Sheridan2014-fo" class="csl-entry">
Sheridan, Sarah L, Katie Frith, Thomas L Snelling, Keith Grimwood, Peter
B McIntyre, and Stephen B Lambert. 2014. <span>“Waning Vaccine Immunity
in Teenagers Primed with Whole Cell and Acellular Pertussis Vaccine:
Recent Epidemiology.”</span> <em>Expert Rev. Vaccines</em> 13 (9):
1081–1106.
</div>
<div id="ref-Storsaeter2003-uk" class="csl-entry">
Storsaeter, Jann, Hans O Hallander, Lennart Gustafsson, and Patrick
Olin. 2003. <span>“Low Levels of Antipertussis Antibodies Plus Lack of
History of Pertussis Correlate with Susceptibility After Household
Exposure to Bordetella Pertussis.”</span> <em>Vaccine</em> 21 (25-26):
3542–49.
</div>
<div id="ref-Voysey2016-gu" class="csl-entry">
Voysey, Merryn, Rama Kandasamy, Ly-Mee Yu, Martine Baudin, Christine
Sadorge, Stéphane Thomas, Tessa John, and Andrew J Pollard. 2016.
<span>“The Predicted Persistence and Kinetics of Antibody Decline 9years
After Pre-School Booster Vaccination in <span>UK</span>
Children.”</span> <em>Vaccine</em> 34 (35): 4221–28.
</div>
<div id="ref-World_Health_Organization2017-hc" class="csl-entry">
World Health Organization. 2017. <span>“Review of Evidence on Vaccine
Effectiveness and Immunogenicity to Assess the Duration of Protection
<span class="math inline">\(\geq\)</span>10 Years After the Last Booster
Dose.”</span>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Arthur Menezes, James Hay.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
