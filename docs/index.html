<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="serosim is an open source R package designed to aid inference from serological surveys, by simulating data arising from user-specified vaccine and infection-generated antibody kinetics processes using a random effects model. serosim allows users to specify and adjust model inputs representing underlying processes responsible for generating the observed titer values like time-varying patterns of infection and vaccination, population demography, immunity and antibody kinetics, and serological survey sampling design in order to best represent the population and disease system(s) of interest.">
<title>Serosurvey simulation • serosim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Serosurvey simulation">
<meta property="og:description" content="serosim is an open source R package designed to aid inference from serological surveys, by simulating data arising from user-specified vaccine and infection-generated antibody kinetics processes using a random effects model. serosim allows users to specify and adjust model inputs representing underlying processes responsible for generating the observed titer values like time-varying patterns of infection and vaccination, population demography, immunity and antibody kinetics, and serological survey sampling design in order to best represent the population and disease system(s) of interest.">
<meta property="og:image" content="https://amenezes97.github.io/serosim/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">serosim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/case_study_1_measles.html">Paper case study 1: One pathogen system with vaccination (Measles)</a>
    <a class="dropdown-item" href="articles/case_study_2_diphtheria_pertussis.html">Paper case study 2: Multi-pathogen system with multivalent vaccinaton (Diphtheria and Pertussis)</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/AMenezes97/serosim/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="serosim">serosim<a class="anchor" aria-label="anchor" href="#serosim"></a>
</h1>
</div>
<p><img src="reference/figures/logo.png" align="right" height="100"></p>
<!-- badges: start -->

</div>
<div class="section level1">
<h1 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h1>
<p>The <em>serosim</em> package is designed to simulate serological survey data arising from user-specified vaccine or infection-generated and antibody kinetics processes. <em>serosim</em> allows users to specify and adjust model inputs responsible for generating the observed biomarker quantities like time-varying patterns of infection and vaccination, population demography, immunity and antibody kinetics, and serological survey sampling design in order to best represent the population and disease system(s) of interest.</p>
<p>Here, we will use the <em>serosim</em> package to generate a simple cross-sectional serosurvey at the end of a 10 year simulation period for 100 individuals who have either been vaccinated, infected, both or neither. We will set up each of the required arguments and models for the <em>runserosim</em> function in the order outlined in the methods section of the paper. We then run the simulation and examine its outputs.</p>
<p>There are two additional vignettes/case studies in the <em>vignettes</em> folder. Case study 1 provides an example of a longitudinal singular biomarker serological survey simulation structured around measles, a one-pathogen system with vaccination, but also applicable to other vaccine preventable diseases. Case study 2 provides an example of a cross-sectional multi-biomarker serological survey structured around diphtheria and pertussis, a two-pathogen system with bivalent vaccination, but also applicable to multi-pathogen systems with multivalent vaccines.</p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<p>Load necessary packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Install and load serosim </span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"AMenezes97/serosim"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── R CMD build ─────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; * checking for file ‘/private/var/folders/q8/2nt_5tqj7yj_rmmxlknjr2sm0000gr/T/RtmpJInDMV/remotesbf496837644a/AMenezes97-serosim-7507fc3/DESCRIPTION’ ... OK</span></span>
<span><span class="co">#&gt; * preparing ‘serosim’:</span></span>
<span><span class="co">#&gt; * checking DESCRIPTION meta-information ... OK</span></span>
<span><span class="co">#&gt; * checking for LF line-endings in source and make files and shell scripts</span></span>
<span><span class="co">#&gt; * checking for empty or unneeded directories</span></span>
<span><span class="co">#&gt; * building ‘serosim_0.0.0.9000.tar.gz’</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AMenezes97/serosim" class="external-link">serosim</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Load additional packages required </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="id_11-simulation-settings">1.1 Simulation Settings<a class="anchor" aria-label="anchor" href="#id_11-simulation-settings"></a>
</h1>
<p>We will simulate monthly time steps across a 10 year period. Therefore, we will have 120 time steps. Note that these are arbitrary time steps which will need to be scaled to the right time resolution to match any time-based parameters used later on.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the number of time steps in the simulation</span></span>
<span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">120</span>,by<span class="op">=</span><span class="fl">1</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## Set simulation settings argument needed for runserosim </span></span>
<span><span class="va">simulation_settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"t_start"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"t_end"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="id_12-population-demography">1.2 Population Demography<a class="anchor" aria-label="anchor" href="#id_12-population-demography"></a>
</h1>
<p>For this case study, we will be simulating a population with 100 individuals and we are not interested in tracking any demography information other than an individual’s birth time. We will use the generate_pop_demography function to create the demography tibble needed for <em>runserosim</em>.</p>
<p>Note: The <em>runserosim</em> function only requires a demography tibble with two columns (individuals and times). In this case it will assume all individuals are born at the start of the simulation period.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Generate the population demography tibble</span></span>
<span><span class="co">## Specify the number of individuals in the simulation; N=100</span></span>
<span><span class="co">## No individuals are removed from the population; prob_removal=0</span></span>
<span><span class="va">demography</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/generate_pop_demography.html">generate_pop_demography</a></span><span class="op">(</span>N<span class="op">=</span><span class="fl">100</span>, times<span class="op">=</span><span class="va">times</span>, prob_removal<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(i)`</span></span>
<span></span>
<span><span class="co">## Examine the generated demography tibble</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">demography</span><span class="op">)</span></span>
<span><span class="co">#&gt;        i              birth           removal        times       </span></span>
<span><span class="co">#&gt;  Min.   :  1.00   Min.   :  1.00   Min.   :121   Min.   :  1.00  </span></span>
<span><span class="co">#&gt;  1st Qu.: 25.75   1st Qu.: 33.25   1st Qu.:121   1st Qu.: 30.75  </span></span>
<span><span class="co">#&gt;  Median : 50.50   Median : 53.00   Median :121   Median : 60.50  </span></span>
<span><span class="co">#&gt;  Mean   : 50.50   Mean   : 55.59   Mean   :121   Mean   : 60.50  </span></span>
<span><span class="co">#&gt;  3rd Qu.: 75.25   3rd Qu.: 80.25   3rd Qu.:121   3rd Qu.: 90.25  </span></span>
<span><span class="co">#&gt;  Max.   :100.00   Max.   :119.00   Max.   :121   Max.   :120.00</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="id_13-exposure-to-biomarker-mapping">1.3 Exposure to biomarker mapping<a class="anchor" aria-label="anchor" href="#id_13-exposure-to-biomarker-mapping"></a>
</h1>
<p>Now we set up the exposure IDs and biomarker IDs for the simulation which will determine which infection or vaccination events are occurring. Here, we will simulate one circulating pathogen (exposure_ID=ifxn) and one vaccine (exposure_ID=vacc) both of which will boost the same biomarker, IgG titers (biomarker_ID=IgG). This biomarker map can be used for any simulations of vaccine preventable diseases like measles vaccination and measles natural infection. <em>runserosim</em> requires that exposure_id and biomarker_id are numeric so we will use the reformat_biomarker_map function to create a new version of the biomarker map. Users can go directly to numeric biomarker_map if they wish.</p>
<p>Note that the reformat_biomarker_map function will number the exposures and biomarkers in alphabetical order so that the first exposure event or biomarker that is listed will not necessarily be labeled as 1.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create biomarker map</span></span>
<span><span class="va">biomarker_map_original</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>exposure_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ifxn"</span>,<span class="st">"vacc"</span><span class="op">)</span>,biomarker_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IgG"</span>,<span class="st">"IgG"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">biomarker_map_original</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span><span class="co">#&gt;   exposure_id biomarker_id</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       </span></span>
<span><span class="co">#&gt; 1 ifxn        IgG         </span></span>
<span><span class="co">#&gt; 2 vacc        IgG</span></span>
<span></span>
<span><span class="co">## Reformat biomarker_map for runserosim</span></span>
<span><span class="va">biomarker_map</span> <span class="op">&lt;-</span><span class="fu"><a href="reference/reformat_biomarker_map.html">reformat_biomarker_map</a></span><span class="op">(</span><span class="va">biomarker_map_original</span><span class="op">)</span></span>
<span><span class="va">biomarker_map</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span><span class="co">#&gt;   exposure_id biomarker_id</span></span>
<span><span class="co">#&gt;         &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1           1            1</span></span>
<span><span class="co">#&gt; 2           2            1</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="id_14-force-of-exposure-and-exposure-model">1.4 Force of Exposure and Exposure Model<a class="anchor" aria-label="anchor" href="#id_14-force-of-exposure-and-exposure-model"></a>
</h1>
<p>Now, we need to specify the foe_pars argument which contains the force of exposure for all exposure_IDs across all time steps. We also specify the exposure model which will be called within <em>runserosim</em> later. The exposure model will determine the probability that an individual is exposed to a specific exposure event. Since we did not specify different groups within demography, all individuals will automatically be assigned group 1. Therefore, we only need 1 row for dimension 1 in foe_pars. Groups can be used as an indicator of location if the user wishes to specify a location specific force of exposure. Dimension 3 of the foe_array must be in the same order as the exposure_id within the biomarker map. For example, the force of exposure for exposure_id 1 will be inputted within the foe_pars[,,1]. We specified the same force of exposure for all time steps within foe_pars for simplicity but users will likely have varying numbers to match real world settings.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create an empty array to store the force of exposure for all exposure types</span></span>
<span><span class="va">foe_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>,<span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">biomarker_map</span><span class="op">$</span><span class="va">exposure_id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Specify the force of exposure for exposure ID 1 which represents natural infection</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span>,,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span>
<span><span class="co">## Specify the force of exposure for exposure ID 2 which represents vaccination</span></span>
<span><span class="va">foe_pars</span><span class="op">[</span>,,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span></span>
<span><span class="co">## Specify a simple exposure model which calculates the probability of exposure directly from the force of exposure at that time step. In this selected model, the probability of exposure is 1-exp(-FOE) where FOE is the force of exposure at that time.</span></span>
<span><span class="va">exposure_model</span><span class="op">&lt;-</span><span class="va">exposure_model_simple_FOE</span></span>
<span></span>
<span><span class="co">## Examine the probability of exposure over time for the specified exposure model and foe_pars array</span></span>
<span><span class="fu"><a href="reference/plot_exposure_model.html">plot_exposure_model</a></span><span class="op">(</span>exposure_model<span class="op">=</span><span class="va">exposure_model_simple_FOE</span>, times<span class="op">=</span><span class="va">times</span>, n_groups <span class="op">=</span> <span class="fl">1</span>, n_exposures <span class="op">=</span> <span class="fl">2</span>, foe_pars<span class="op">=</span><span class="va">foe_pars</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png"><!-- --></p>
</div>
<div class="section level1">
<h1 id="id_15-immunity-model">1.5 Immunity Model<a class="anchor" aria-label="anchor" href="#id_15-immunity-model"></a>
</h1>
<p>Here, we specify the immunity model which will determine the probability that an exposure event is successful in producing an immunological response. We will use a simple immunity model (immunity_model_vacc_ifxn_simple) where successful exposure is only conditional on the total number of previous exposure events. With this model, the probability of successful vaccination exposure depends on the number of vaccines received prior to time t and the individual’s age at time t while the probability of successful infection is dependent on the number of infections prior to time t.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify immunity model within runserosim function below </span></span>
<span><span class="va">immunity_model</span><span class="op">&lt;-</span><span class="va">immunity_model_vacc_ifxn_simple</span></span>
<span></span>
<span><span class="co">## Create 3 additional arguments needed for this immunity model </span></span>
<span><span class="co">## Specify which exposure IDs represent vaccination events </span></span>
<span><span class="va">vacc_exposures</span><span class="op">&lt;-</span><span class="fl">2</span></span>
<span><span class="co">## Specify the age at which an individual is eligible for vaccination (9 months old); note non vaccine exposures are listed as NAs</span></span>
<span><span class="va">vacc_age</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fl">9</span><span class="op">)</span></span>
<span><span class="co">## Specify the maximum number of successful events an individual can receive for each exposure type (1 infection event and 1 vaccination event)</span></span>
<span><span class="va">max_events</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="id_16-antibody-model-and-model-parameters">1.6 Antibody Model and Model Parameters<a class="anchor" aria-label="anchor" href="#id_16-antibody-model-and-model-parameters"></a>
</h1>
<p>Now, we specify the antibody model to be used within <em>runserosim</em> to track antibody kinetics, or more broadly biomarker kinetics for each biomarker produced from successful exposure events. We will be using a monophasic boosting-waning model in this example. This model assumes that for each exposure there is a boost and boost waning parameter. The antibody kinetics parameters are pre-loaded within a csv file. Users can edit the csv file to specify their own parameters. All parameters needed for the user specified antibody model must be specified within the model_pars. Lastly, we define the draw_parameters function which determines how each individual’s antibody kinetics parameters are simulated from the within-host processes parameters tibble (model_pars). We will use a function which draws parameters directly from model_pars for the antibody model with random effects to represent individual heterogeneity in immunological responses. Parameters are drawn randomly from a distribution with mean and standard deviation specified within model_pars. <em>runserosim</em> requires that exposure_id and biomarker_id within model_pars are numeric and match the exposure to biomarker map so we will use the reformat_biomarker_map function again to create a new version of model_pars. Users can go directly to numeric model_pars if they wish.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the antibody model </span></span>
<span><span class="va">antibody_model</span><span class="op">&lt;-</span><span class="va">antibody_model_monophasic</span></span>
<span></span>
<span><span class="co">## Bring in the antibody parameters needed for the antibody model</span></span>
<span><span class="co">## Note that the observation error parameter needed for the observation model (Section 1.7) is defined here too.</span></span>
<span><span class="va">model_pars_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"model_pars_README.csv"</span>, package <span class="op">=</span> <span class="st">"serosim"</span><span class="op">)</span></span>
<span><span class="va">model_pars_original</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">model_pars_path</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">model_pars_original</span> </span>
<span><span class="co">#&gt;   exposure_id biomarker_id   name   mean     sd distribution</span></span>
<span><span class="co">#&gt; 1        ifxn          IgG  boost 4.0000 2.0000   log-normal</span></span>
<span><span class="co">#&gt; 2        ifxn          IgG   wane 0.0033 0.0005   log-normal</span></span>
<span><span class="co">#&gt; 3        &lt;NA&gt;          IgG obs_sd     NA 0.2500       normal</span></span>
<span><span class="co">#&gt; 4        vacc          IgG  boost 2.0000 1.0000   log-normal</span></span>
<span><span class="co">#&gt; 5        vacc          IgG   wane 0.0016 0.0005   log-normal</span></span>
<span></span>
<span><span class="co">## Reformat model_pars for runserosim</span></span>
<span><span class="va">model_pars</span><span class="op">&lt;-</span><span class="fu"><a href="reference/reformat_biomarker_map.html">reformat_biomarker_map</a></span><span class="op">(</span><span class="va">model_pars_original</span><span class="op">)</span></span>
<span><span class="va">model_pars</span></span>
<span><span class="co">#&gt;   exposure_id biomarker_id   name   mean     sd distribution</span></span>
<span><span class="co">#&gt; 1           1            1  boost 4.0000 2.0000   log-normal</span></span>
<span><span class="co">#&gt; 2           1            1   wane 0.0033 0.0005   log-normal</span></span>
<span><span class="co">#&gt; 3          NA            1 obs_sd     NA 0.2500       normal</span></span>
<span><span class="co">#&gt; 4           2            1  boost 2.0000 1.0000   log-normal</span></span>
<span><span class="co">#&gt; 5           2            1   wane 0.0016 0.0005   log-normal</span></span>
<span></span>
<span><span class="co">## Specify the draw_parameters function</span></span>
<span><span class="va">draw_parameters</span><span class="op">&lt;-</span><span class="va">draw_parameters_random_fx</span></span>
<span></span>
<span><span class="co">## Plot example biomarker trajectories given the specified antibody kinetics model, model parameters and draw parameters function </span></span>
<span><span class="fu"><a href="reference/plot_antibody_model.html">plot_antibody_model</a></span><span class="op">(</span><span class="va">antibody_model_monophasic</span>, N<span class="op">=</span><span class="fl">100</span>, model_pars<span class="op">=</span><span class="va">model_pars</span>,draw_parameters_fn <span class="op">=</span> <span class="va">draw_parameters_random_fx</span>, biomarker_map<span class="op">=</span><span class="va">biomarker_map</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.png"><!-- --></p>
</div>
<div class="section level1">
<h1 id="id_17-observation-model-and-observation_times">1.7 Observation Model and observation_times<a class="anchor" aria-label="anchor" href="#id_17-observation-model-and-observation_times"></a>
</h1>
<p>Now we specify how observed biomarker quantities are generated as a probabilistic function of the true, latent biomarker quantity and when to observe these quantities. In this step, we specify the sampling design and assay choice for our serological survey. We will take samples of all individuals at the end of the simulation (t=120).</p>
<p>Our chosen observation model observes the latent biomarker quantity given a continuous assay with added noise. The added noise represents assay variability and is implemented by sampling from a distribution with the true latent biomarker quantity as the mean and the measurement error as the standard deviation. The observation standard deviation and distribution are defined within model_pars as the “obs_sd” parameter. Within this observation model, we can also specify the assay sensitivity and specificity.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the observation model </span></span>
<span><span class="va">observation_model</span><span class="op">&lt;-</span><span class="va">observation_model_continuous_noise</span></span>
<span></span>
<span><span class="co">## Specify assay sensitivity and specificity needed for the observation model</span></span>
<span><span class="va">sensitivity</span><span class="op">&lt;-</span><span class="fl">0.85</span></span>
<span><span class="va">specificity</span><span class="op">&lt;-</span><span class="fl">0.9</span></span>
<span></span>
<span><span class="co">## Specify observation_times (serological survey sampling design) to observe biomarker 1 across all individuals at the end of the simulation (t=120)</span></span>
<span><span class="va">observation_times</span><span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>i<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">demography</span><span class="op">$</span><span class="va">i</span><span class="op">)</span>,t<span class="op">=</span><span class="fl">120</span>, b<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="id_18-optional-arguments">1.8 Optional Arguments<a class="anchor" aria-label="anchor" href="#id_18-optional-arguments"></a>
</h1>
<p>There are no optional arguments needed for this simulation.</p>
</div>
<div class="section level1">
<h1 id="id_19-run-simulation">1.9 Run Simulation<a class="anchor" aria-label="anchor" href="#id_19-run-simulation"></a>
</h1>
<p>This is the core simulation where all simulation settings, models and parameters are specified within the main simulation function. Run time for this step varies depending on the number of individuals and the complexities of the specified models. There is a built in pre-computation step within <em>runserosim</em> where the simulation attempts to perform as much pre-computation as possible for the exposure model to speed up the main simulation code. Users can turn off this pre-computation by setting pre-computation to FALSE within <em>runserosim</em>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Run the core simulation and save outputs in "res"</span></span>
<span><span class="va">res</span><span class="op">&lt;-</span> <span class="fu"><a href="reference/runserosim.html">runserosim</a></span><span class="op">(</span></span>
<span>  <span class="va">simulation_settings</span>,</span>
<span>  <span class="va">demography</span>,</span>
<span>  <span class="va">observation_times</span>,</span>
<span>  <span class="va">foe_pars</span>,</span>
<span>  <span class="va">biomarker_map</span>,</span>
<span>  <span class="va">model_pars</span>,</span>
<span>  <span class="va">exposure_model</span>,</span>
<span>  <span class="va">immunity_model</span>,</span>
<span>  <span class="va">antibody_model</span>,</span>
<span>  <span class="va">observation_model</span>,</span>
<span>  <span class="va">draw_parameters</span>,</span>
<span></span>
<span>  <span class="co">## Other arguments needed</span></span>
<span>  max_events<span class="op">=</span><span class="va">max_events</span>,</span>
<span>  vacc_exposures<span class="op">=</span><span class="va">vacc_exposures</span>,</span>
<span>  vacc_age<span class="op">=</span><span class="va">vacc_age</span>,</span>
<span>  sensitivity<span class="op">=</span><span class="va">sensitivity</span>,</span>
<span>  specificity<span class="op">=</span><span class="va">specificity</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Note that models and arguments specified earlier in the code can be specified directly within this function.</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="id_110-generate-plots">1.10 Generate Plots<a class="anchor" aria-label="anchor" href="#id_110-generate-plots"></a>
</h1>
<p>Now that the simulation is complete, let’s plot and examine the simulation outputs.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot biomarker kinetics and exposure histories for 10 individuals </span></span>
<span><span class="fu"><a href="reference/plot_subset_individuals_history.html">plot_subset_individuals_history</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">biomarker_states</span>, <span class="va">res</span><span class="op">$</span><span class="va">exposure_histories_long</span>, subset<span class="op">=</span><span class="fl">10</span>, <span class="va">demography</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-1.png"><!-- --></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Plot individual force of exposure for all exposure types</span></span>
<span><span class="co">## This is the output of the exposure model.</span></span>
<span><span class="co">## Note: All individuals are under the same force of exposure since we specified a simple exposure model and constant foe_pars</span></span>
<span><span class="fu"><a href="reference/plot_exposure_force.html">plot_exposure_force</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">exposure_force_long</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-2.png"><!-- --></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Plot individual successful exposure probabilities for all exposure types</span></span>
<span><span class="co">## This is the output of the exposure model multiplied by the output of the immunity model.</span></span>
<span><span class="co">## In other words, this is the probability of an exposure event being successful and inducing an immunological response</span></span>
<span><span class="fu"><a href="reference/plot_exposure_prob.html">plot_exposure_prob</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">exposure_probabilities_long</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-3.png"><!-- --></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Plot individual exposure histories for all exposure types</span></span>
<span><span class="fu"><a href="reference/plot_exposure_histories.html">plot_exposure_histories</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">exposure_histories_long</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-4.png"><!-- --></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Plot true biomarker quantities for all individuals across the entire simulation period</span></span>
<span><span class="fu"><a href="reference/plot_biomarker_quantity.html">plot_biomarker_quantity</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">biomarker_states</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-5.png"><!-- --></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Plot the serosurvey results (observed biomarker quantities)</span></span>
<span><span class="fu"><a href="reference/plot_obs_biomarkers_one_sample.html">plot_obs_biomarkers_one_sample</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">observed_biomarker_states</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-6.png"><!-- --></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Note that the simulated kinetics parameters are also stored</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">kinetics_parameters</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 7</span></span>
<span><span class="co">#&gt;       i     t     x     b name    value realized_value</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;          &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1    87     2     1 boost 4.01           4.01   </span></span>
<span><span class="co">#&gt; 2     1    87     2     1 wane  0.00132        0.00132</span></span>
<span><span class="co">#&gt; 3     2    93     1     1 boost 4.98           4.98   </span></span>
<span><span class="co">#&gt; 4     2    93     1     1 wane  0.00546        0.00546</span></span>
<span><span class="co">#&gt; 5     2    93     2     1 boost 3.54           3.54   </span></span>
<span><span class="co">#&gt; 6     2    93     2     1 wane  0.00179        0.00179</span></span>
<span></span>
<span><span class="co">## Combine plots as seen in paper </span></span>
<span><span class="co"># library(cowplot)</span></span>
<span><span class="co"># plot_grid(plot_exposure_prob(res$exposure_probabilities_long), plot_exposure_histories(res$exposure_histories_long), nrow=1, ncol=2, align = "hv", scale=c(.98,.98))</span></span>
<span><span class="co"># plot_grid(plot_biomarker_quantity(res$biomarker_states), plot_obs_biomarkers_one_sample(res$observed_biomarker_states), nrow=1, ncol=2, align = "hv", scale=c(.98,.98))</span></span></code></pre></div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/AMenezes97/serosim/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/AMenezes97/serosim/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing serosim</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Arthur Menezes <br><small class="roles"> Author, maintainer </small>  </li>
<li>James Hay <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/AMenezes97/serosim/actions/workflows/check-standard.yaml" class="external-link"><img src="https://github.com/AMenezes97/serosim/actions/workflows/check-standard.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://www.codefactor.io/repository/github/amenezes97/serosim" class="external-link"><img src="https://www.codefactor.io/repository/github/amenezes97/serosim/badge" alt="CodeFactor"></a></li>
<li><a href="https://github.com/AMenezes97/serosim/actions/workflows/test-coverage.yaml" class="external-link"><img src="https://github.com/AMenezes97/serosim/actions/workflows/test-coverage.yaml/badge.svg" alt="test-coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Arthur Menezes, James Hay.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
